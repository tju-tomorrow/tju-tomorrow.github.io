<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>My First Post</title>
    <url>/2024/07/25/2024-07-25-the-First-One-2024/</url>
    <content><![CDATA[<h2 id="Hey"><a href="#Hey" class="headerlink" title="Hey"></a>Hey</h2><blockquote>
<p>&#x8FD9;&#x662F;&#x6211;&#x7684;&#x7B2C;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x3002;</p>
</blockquote>
<h3 id="preface"><a href="#preface" class="headerlink" title="preface"></a>preface</h3><p>In the first blog I want to talk about methods of primitives.We know objects have methods and in javascript we have the power to treat them as they were objects.</p>
<span id="more"></span>

<h3 id="first-why-we-want-to-treat-primitives-like-objects"><a href="#first-why-we-want-to-treat-primitives-like-objects" class="headerlink" title="first why we want to treat primitives like objects"></a>first why we want to treat primitives like objects</h3><p>There are many things one would want to do with a primitive, like a string or a number. It would be great to access them using methods.</p>
<hr>

<p>We should know the respective specialities of primitive and object before we want to combine the speciality in object(have methods) into the mechanism of primitive</p>
<h3 id="the-distinctions-between-primitive-and-object"><a href="#the-distinctions-between-primitive-and-object" class="headerlink" title="the distinctions between primitive and object"></a>the distinctions between primitive and object</h3><h4 id="primitive"><a href="#primitive" class="headerlink" title="primitive"></a>primitive</h4><p>is a value of the basic type <code>string</code>, <code>number</code>, <code>bigint</code>, <code>boolean</code>, <code>symbol</code>, <code>null</code> and <code>undefined</code>.<br>So it&#x2019;s light-weight.</p>
<h4 id="object"><a href="#object" class="headerlink" title="object"></a>object</h4><p>object is capable to store mutiple values as their &#x201C;properties&#x201D;</p>
<p>there is a <strong>superiority</strong> of object that is : we can insert or store a function into a property</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> object = {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jack&quot;</span>,</span><br><span class="line">  <span class="attr">sayhi</span>: <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<h4 id="So-Objects-are-&#x201C;heavier&#x201D;-than-primitives-They-require-additional-resources-to-support-the-internal-machinery"><a href="#So-Objects-are-&#x201C;heavier&#x201D;-than-primitives-They-require-additional-resources-to-support-the-internal-machinery" class="headerlink" title="So Objects are &#x201C;heavier&#x201D; than primitives. They require additional resources to support the internal machinery."></a>So Objects are &#x201C;heavier&#x201D; than primitives. They require additional resources to support the internal machinery.</h4><p>Then we manage to add the speciality into primitive which is being able to use &#x201C;.&#x201D; to invoke some methods.</p>
<h3 id="How-to-accomplish-that-treat-primitives-like-objects"><a href="#How-to-accomplish-that-treat-primitives-like-objects" class="headerlink" title="How to accomplish that : treat primitives like objects"></a>How to accomplish that : treat primitives like objects</h3><p>With the speciality added,</p>
<p>we also want to keep primitives lightweight In the meantime.</p>
<p>So here we think :Only When we want to operate primitives with methods they are objects And When we don&#x2019;t need that they change back to primitive (So that they can provide methods, but they still remain lightweight)<br>So flexible!</p>
<p>In order to do that :<strong>a special &#x201C;object wrapper&#x201D; that provides the extra functionality is created, and then is destroyed.</strong></p>
<h4 id="Dive-in"><a href="#Dive-in" class="headerlink" title="Dive in"></a>Dive in</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let str = &quot;Hello&quot;;</span><br><span class="line"></span><br><span class="line">alert( str.toUpperCase() ); // HELLO</span><br></pre></td></tr></table></figure>

<ol>
<li>The string <code>str</code> is a primitive. So in the moment of accessing its property, a special object is created that <strong>knows the value of the string</strong>, and has useful methods, like <code>toUpperCase()</code>.</li>
<li>That method runs and returns a new string (shown by <code>alert</code>).</li>
<li>The special object is destroyed, leaving the primitive <code>str</code> alone.</li>
</ol>
<p>Which means something besides the simple and standalone value is actually created!</p>
<h4 id="Some-details-to-supplementary"><a href="#Some-details-to-supplementary" class="headerlink" title="Some details to supplementary"></a>Some details to supplementary</h4><ol>
<li><p><strong>null/undefined have no methods</strong><br>In a sense, they are &#x201C;the most primitive&#x201D;.</p>
</li>
<li><p>using the same functions <code>String/Number/Boolean</code> without <code>new</code> is totally fine and useful thing. They convert a value to the corresponding type: to a string, a number, or a boolean (primitive).</p>
<p>For example, this is entirely valid:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="title class_">Number</span>(<span class="string">&quot;123&quot;</span>); <span class="comment">// convert a string to number</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Still !! <strong>primitives are not objects.</strong> which means they can&#x2019;t store additional data</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let str = &quot;Hello&quot;;</span><br><span class="line"></span><br><span class="line">str.test = 5;</span><br><span class="line"></span><br><span class="line">alert(str.test);</span><br></pre></td></tr></table></figure>

<p>the result will be</p>
<ol>
<li><code>undefined</code> (no strict mode)</li>
<li>An error (strict mode).</li>
</ol>
<p>The reason is that &#x201C;wrapper object&#x201D; :<br>when you use &#x201C;.&#x201D; after &#x201C;str&#x201D; (in other words when you wanna access the &#x201C;str&#x201D;) the &#x201C;wrapper object&#x201D; is created.</p>
<ol>
<li>in &#x201C;no strict mode&#x201D; it carries the &#x201C;test&#x201D; property but remember it will disappear When you see the &#x201C;;&#x201D; after&#x201D;5;&#x201D; it disappears. So you won&#x2019;t have the trace of the &#x201C;wrapper object&#x201D; .It vanishes with no trace. So you could only get &#x201C;undefined&#x201D;</li>
<li>in &#x201C;strict mode&#x201D; : there is a red flag or a Rule that cannot be crossed : you can&#x2019;t write into &#x201C;wrapper object&#x201D; So An error</li>
</ol>
]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>data types</tag>
        <tag>数据类型</tag>
      </tags>
  </entry>
  <entry>
    <title>Promise chainning</title>
    <url>/2024/07/28/2024-07-28-Promise-chainning-2024/</url>
    <content><![CDATA[<h1 id="Promise-chainning"><a href="#Promise-chainning" class="headerlink" title="Promise chainning"></a>Promise chainning</h1><h2 id="what-is-Promise-chainning"><a href="#what-is-Promise-chainning" class="headerlink" title="what is Promise chainning"></a>what is Promise chainning</h2><p>A Promise-chain starts with <code>new Promise</code> constructor and use<code>then/catch</code> as middle-party to pass the <code>promise.result</code></p>
<span id="more"></span>

<p>which is formed like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>); <span class="comment">// (*)</span></span><br><span class="line">})</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="comment">// (**)</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="comment">// (***)</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 4</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<h2 id="why-it&#x2019;s-created"><a href="#why-it&#x2019;s-created" class="headerlink" title="why it&#x2019;s created"></a>why it&#x2019;s created</h2><p>We have a sequence of asynchronous tasks needed to be performed one after another In other words:When dealing with tasks that have sequencial order<br>for instance, loading scripts.<br>we can&#x2019;t hold all tasks in one &#x201C;then&#x201D; handler<br>It&#x2019;s known that When a handler returns a value, it becomes the result of that promise and in this chainning system<br>the promise holding a value peformed by the last handler become the input of next handler</p>
<p>analogy:<br>If you look at this in a broad way<br>you can see Promise keep a emerge-dive pattern like a joyful fish<br>The Promise-wrapper is the same just the inside-value(or result) changes each time emerge-dive</p>
<h2 id="returning-promise"><a href="#returning-promise" class="headerlink" title="returning promise"></a>returning promise</h2><p>A handler, used in <code>.then(handler)</code> may create and return a promise.<br>In that case further handlers <strong>wait</strong> until it settles, and then get its result.</p>
<p>For instance:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>);</span><br><span class="line">})</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">      <span class="comment">// (*)</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result * <span class="number">2</span>), <span class="number">1000</span>);</span><br><span class="line">    });</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="comment">// (**)</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result * <span class="number">2</span>), <span class="number">1000</span>);</span><br><span class="line">    });</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result); <span class="comment">// 4</span></span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]</p>
<p>In <code>then</code> handler if you return a value the value become a Promise for the next <code>then</code><br>But returning a Promise seems more reasonable</p>
</blockquote>
<p>So the output is the same as in the previous example: 1 &#x2192; 2 &#x2192; 4, but now with 1 second delay between <code>alert</code> calls.</p>
<h2 id="Here-we-go-Useful-example-loadscript"><a href="#Here-we-go-Useful-example-loadscript" class="headerlink" title="Here we go ! Useful example : loadscript"></a>Here we go ! Useful example : loadscript</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/one.js&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">script</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/two.js&quot;</span>);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">script</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/three.js&quot;</span>);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">script</span>) {</span><br><span class="line">    <span class="comment">// use functions declared in scripts</span></span><br><span class="line">    <span class="comment">// to show that they indeed loaded</span></span><br><span class="line">    <span class="title function_">one</span>();</span><br><span class="line">    <span class="title function_">two</span>();</span><br><span class="line">    <span class="title function_">three</span>();</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<p>This code can be made bit shorter with arrow functions:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/one.js&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">script</span>) =&gt;</span> <span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/two.js&quot;</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">script</span>) =&gt;</span> <span class="title function_">loadScript</span>(<span class="string">&quot;/article/promise-chaining/three.js&quot;</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">script</span>) =&gt;</span> {</span><br><span class="line">    <span class="comment">// scripts are loaded, we can use functions declared there</span></span><br><span class="line">    <span class="title function_">one</span>();</span><br><span class="line">    <span class="title function_">two</span>();</span><br><span class="line">    <span class="title function_">three</span>();</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<h2 id="A-special-feature"><a href="#A-special-feature" class="headerlink" title="A special feature"></a>A special feature</h2><p><strong>This feature will allow us to integrate custom objects with promise chains without having to inherit from Promise</strong><br>What does above mean ? To understand that there should be a clarification:<br><strong>Actually in the promise-chain It&#x2019;s not promise that continuely flow up and down (return and input)(that means what the handler returns is not Promise ) It&#x2019;s another special object called <em>&#x201C;thenable&#x201D; object</em></strong><br>All the things we said above still <strong>valid</strong> because this &#x201C;thenable&#x201D; object has <em>.then</em> method and can be treated like Promise.So actually it gives us flexibilty!Because we can build like an architect on a object that has already implemented with basic Promise-function</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Thenable</span> {</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">num</span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">num</span> = num;</span><br><span class="line">  }</span><br><span class="line">  <span class="title function_">then</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(resolve); <span class="comment">// function() { native code }</span></span><br><span class="line">    <span class="comment">// resolve with this.num*2 after the 1 second</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">num</span> * <span class="number">2</span>), <span class="number">1000</span>); <span class="comment">// (**)</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Thenable</span>(result); <span class="comment">// (*)</span></span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(alert); <span class="comment">// shows 2 after 1000ms</span></span><br></pre></td></tr></table></figure>

<p>JavaScript checks the object returned by the <code>.then</code> handler in line <code>(*)</code>: if it has a callable method named <code>then</code>, then it calls that method providing native functions <code>resolve</code>, <code>reject</code> as arguments (similar to an executor) and waits until one of them is called. In the example above <code>resolve(2)</code> is called after 1 second <code>(**)</code>. Then the result is passed further down the chain.</p>
<blockquote>
<p>[!TIP]</p>
<p>A Thenable class should still define the <code>then</code> method inside<br>And what is passed into the constructor is actually the <code>promise.result</code></p>
</blockquote>
<h2 id="example-associated-with-fetch"><a href="#example-associated-with-fetch" class="headerlink" title="example associated with fetch"></a>example associated with <em>fetch</em></h2><p>We&#x2019;ll use the <a href="https://javascript.info/fetch">fetch</a> method to load the information about the user from the remote server. It has a lot of optional parameters covered in <a href="https://javascript.info/fetch">separate chapters</a>, but the basic syntax is quite simple:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title function_">fetch</span>(url);</span><br></pre></td></tr></table></figure>

<p>fetch(url) is saying :make a network request to the <code>url</code> and returns a promise. The promise resolves with a <code>response</code> object when the remote server responds with headers, but <em>before the full response is downloaded</em>.</p>
<blockquote>
<p>[!NOTE]</p>
<p>You haven&#x2019;t got the infomation now</p>
</blockquote>
<p>To read the full response, we should call the method <code>response.text()</code>: it returns a promise that resolves when the full text is downloaded from the remote server, with that text(information we require) as a result.</p>
<blockquote>
<p>[!NOTE]</p>
<p>So response is a promise and response.text() is also a promise</p>
</blockquote>
<p>The code below makes a request to <code>user.json</code> and loads its text from the server:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/article/promise-chaining/user.json&quot;</span>)</span><br><span class="line">  <span class="comment">// .then below runs when the remote server responds</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="comment">// response.text() returns a new promise that resolves with the full response text</span></span><br><span class="line">    <span class="comment">// when it loads</span></span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">text</span>();</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">text</span>) {</span><br><span class="line">    <span class="comment">// ...and here&apos;s the content of the remote file</span></span><br><span class="line">    <span class="title function_">alert</span>(text); <span class="comment">// {&quot;name&quot;: &quot;iliakan&quot;, &quot;isAdmin&quot;: true}</span></span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<p>The <code>response</code> object returned from <code>fetch</code> also includes the method <code>response.json()</code> that reads the remote data and parses it as JSON. In our case that&#x2019;s even more convenient</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// same as above, but response.json() parses the remote content as JSON</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/article/promise-chaining/user.json&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> <span class="title function_">alert</span>(user.<span class="property">name</span>)); <span class="comment">// iliakan, got user name</span></span><br></pre></td></tr></table></figure>

<p>let&#x2019;s see a more complex one :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Make a request for user.json</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/article/promise-chaining/user.json&quot;</span>)</span><br><span class="line">  <span class="comment">// Load it as json</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  <span class="comment">// Make a request to GitHub</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">${user.name}</span>`</span>))</span><br><span class="line">  <span class="comment">// Load the response as json</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  <span class="comment">// Show the avatar image (githubUser.avatar_url) for 3 seconds (maybe animate it)</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">githubUser</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">    img.<span class="property">src</span> = githubUser.<span class="property">avatar_url</span>;</span><br><span class="line">    img.<span class="property">className</span> = <span class="string">&quot;promise-avatar-example&quot;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(img);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> img.<span class="title function_">remove</span>(), <span class="number">3000</span>); <span class="comment">// (*)</span></span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<p>this works but below is much better :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/article/promise-chaining/user.json&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">${user.name}</span>`</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">githubUser</span>) =&gt;</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">        <span class="comment">// (*)</span></span><br><span class="line">        <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">        img.<span class="property">src</span> = githubUser.<span class="property">avatar_url</span>;</span><br><span class="line">        img.<span class="property">className</span> = <span class="string">&quot;promise-avatar-example&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(img);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">          img.<span class="title function_">remove</span>();</span><br><span class="line">          <span class="title function_">resolve</span>(githubUser); <span class="comment">// (**)</span></span><br><span class="line">        }, <span class="number">3000</span>);</span><br><span class="line">      })</span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// triggers after 3 seconds</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">githubUser</span>) =&gt;</span> <span class="title function_">alert</span>(<span class="string">`Finished showing <span class="subst">${githubUser.name}</span>`</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!CAUTION]</p>
<p>As a good practice, an asynchronous action should always return a promise.</p>
</blockquote>
<p>That makes it possible to plan actions after it; even if we don&#x2019;t plan to extend the chain now, we may need it later.</p>
<h2 id="When-should-you-consider-about-Promise"><a href="#When-should-you-consider-about-Promise" class="headerlink" title="When should you consider about Promise"></a>When should you consider about Promise</h2><p>In the last chapter <em>Promise</em> we bury a seed in the last.This is the position it should get settled<br>So promise is actually used in a situation : 1.the task is gonna need some time 2. there are two possible consequences of the task3.mostly have to do with networking connection<br>let us see some egs</p>
<ol>
<li><pre><code class="js">fetch(&quot;https://api.examplecom/data&quot;)
  .then((response) =&gt; response.json())
  .then((data) =&gt; console.log(data))
  .catch((error) =&gt; console.log(error));
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   fetch is a api that allows us to input a url as a door to get data and this api return a promise</span><br><span class="line">   (of course! 1.Getting is absolutely a task that requires some time2.two consequences : get it or miss it)</span><br><span class="line">   And during each level of the chain promise.result is passed as paramter for handler</span><br><span class="line"></span><br><span class="line">2. ```js</span><br><span class="line">   function LoadImage(url) {</span><br><span class="line">     return new Promise((resolve, reject) =&gt; {</span><br><span class="line">       const img = new Image(); //create a img</span><br><span class="line">       img.src = url;</span><br><span class="line">       img.onload = () =&gt; resolve(img);</span><br><span class="line">       img.onerror = () =&gt; reject(new Error(&quot;fail loading&quot;));</span><br><span class="line">     });</span><br><span class="line">   }</span><br><span class="line">   LoadImage(&quot;path/to/image.jpg&quot;)</span><br><span class="line">     .then((img) =&gt; document.body.appendChild(img))</span><br><span class="line">     .catch((error) =&gt; console.error(error));</span><br></pre></td></tr></table></figure>

Why do you need to bind functionc to events of img?
Cause two callback must be called .And when you wanna use then/catch handler to link the function(LoadImage).It should be a produced (fully formed)promise in front of these handlers
</code></pre>
</li>
<li><p>Custom Promise<br>Promise basically follow this pattern:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (success) {</span><br><span class="line">      <span class="title function_">resolve</span>(result);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error&quot;</span>));</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">}</span><br><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ajax with XMLHttpRequest</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url</span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url);</span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">    xhr.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ajax failed&quot;</span>));</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">  });</span><br><span class="line">}</span><br><span class="line"><span class="title function_">ajax</span>(<span class="string">&quot;https://&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Promise</tag>
      </tags>
  </entry>
  <entry>
    <title>Promise</title>
    <url>/2024/07/27/2024-07-27-Promise-2024/</url>
    <content><![CDATA[<h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><h2 id="Preface-Scene-Imagination-lead-to-Promise"><a href="#Preface-Scene-Imagination-lead-to-Promise" class="headerlink" title="Preface:Scene Imagination lead to Promise"></a>Preface:Scene Imagination lead to Promise</h2><blockquote>
<p>Imagine that you&#x2019;re a top singer, and fans ask day and night for your upcoming song.</p>
</blockquote>
<span id="more"></span>

<blockquote>
<p>To get some relief, you promise to send it to them when it&#x2019;s published. You give your fans a list. They can fill in their email addresses, so that when the song becomes available, all subscribed parties instantly receive it. And even if something goes very wrong, say, a fire in the studio, so that you can&#x2019;t publish the song, they will still be notified.</p>
</blockquote>
<p>For the first sight:1.What?Promise is made by the singer and<br>2.Why?it&#x2019;s produced because the result can&#x2019;t be immediate.<br>3.Efficacy?And promise connects singer and prospective subcribers. and makes it possible for the existence of delay.So it&#x2019;s actually for dealing tasks that requires <strong>time</strong>.</p>
<p>And To map to concepts about Promise :</p>
<ol>
<li>&#x201C;A producing code&#x201D; is the singer. It can&#x2019;t immediately give program-flow or another-code a result so that program-flow can proceed So it make a <em>promise</em> .<br>What may be the &#x201C;producing code&#x201D; :For instance, some code that loads the data over a network and that takes <strong>time</strong></li>
<li>A &#x201C;consuming code&#x201D;(another-code that mentioned above) that wants the result of the &#x201C;producing code&#x201D; once it&#x2019;s ready(for inputing paramters or something else) .These are the &#x201C;fans&#x201D;.</li>
<li><strong>A <em>promise</em> is a special JavaScript</strong> object that links the &#x201C;producing code&#x201D; and the &#x201C;consuming code&#x201D; together. In terms of our analogy: this is the &#x201C;subscription list&#x201D;. The &#x201C;producing code&#x201D; takes whatever time it needs to produce the promised result, and the &#x201C;promise&#x201D; makes that result available to all of the subscribed code when it&#x2019;s ready.</li>
</ol>
<h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><p>The constructor syntax for a promise object is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">  <span class="comment">// executor (the producing code, &quot;singer&quot;)</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>To explain:</p>
<ol>
<li><p>The function passed to <code>new Promise</code> is called the <em>executor</em>.</p>
<p>When <code>new Promise</code> is created, the executor runs <strong>automatically</strong>(this is a func don&#x2019;t need to be called by&#x201D;()&#x201D;). It contains the producing code which should eventually produce the result. In terms of the analogy above: the executor is the &#x201C;singer&#x201D;.</p>
</li>
<li><p>Its arguments <code>resolve</code> and <code>reject</code> are callbacks provided by JavaScript itself.</p>
</li>
<li><p>When the executor obtains the result, be it soon or late, doesn&#x2019;t matter,it should call one of these callbacks:</p>
<ul>
<li><p><code>resolve(value)</code> &#x2014; if the job is finished successfully, with result <code>value</code>.</p>
</li>
<li><p><code>reject(error)</code> &#x2014; if an error has occurred, <code>error</code> is a Error object.<br>To supplementay:</p>
<blockquote>
<p>[!CAUTION]</p>
<p>The executor receives two arguments: <code>resolve</code> and <code>reject</code>. These functions are pre-defined by the JavaScript engine, so we don&#x2019;t need to create them. We should only call one of them when ready.<br>the executor may calls <code>resolve(&quot;done&quot;)</code> to produce the <strong>result</strong>(remember above we said the executor should eventually produce the result? Yeah it can be done by calling resolve)</p>
</blockquote>
</li>
</ul>
</li>
<li><p>So to summarize: the executor runs automatically and attempts to perform a job. When it is finished with the attempt, it calls <code>resolve</code> if it was successful or <code>reject</code> if there was an error.</p>
<blockquote>
<p>[!Important]</p>
<p>1.So Promise constructor requires a function that contains two built-in callbacks as paramter And the function is <em>the</em> executor<br>2.executor carries two callback that is ready to be called and then produces the <strong>result</strong><br>3.result exists relating to two possible state<br>4.what is eventually returned by this syntax constructor is actually a object which is the Promise. And result is just been carried with.</p>
</blockquote>
</li>
</ol>
<hr>

<p>To proceed:</p>
<p><strong>The <code>promise</code> object returned</strong> by the <code>new Promise</code> constructor has these internal properties:</p>
<ul>
<li><code>state</code> &#x2014; initially <code>&quot;pending&quot;</code>, then changes to either <code>&quot;fulfilled&quot;</code> when <code>resolve</code> is called or <code>&quot;rejected&quot;</code> when <code>reject</code> is called.</li>
<li><code>result</code> &#x2014; initially <code>undefined</code>, then changes to <code>value</code> when <code>resolve(value)</code> is called or <code>error</code> when <code>reject(error)</code> is called.</li>
</ul>
<p>So the executor eventually moves <code>promise</code> to one of these states:<img src="/2024/07/27/2024-07-27-Promise-2024/07/27/2024-07-27-Promise-2024/GitHub%20download/typora/%E6%96%87%E4%BB%B6%E9%9B%86%E5%90%88/Blogs/Promise/Promise.assets/image-20240727013201754.png" alt="image-20240727013201754"></p>
<p>and if we successfully produce the result which the consuming codes are craving for. It turned like this:<img src="/2024/07/27/2024-07-27-Promise-2024/07/27/2024-07-27-Promise-2024/GitHub%20download/typora/%E6%96%87%E4%BB%B6%E9%9B%86%E5%90%88/Blogs/Promise/Promise.assets/image-20240727014147939.png" alt="image-20240727014147939"></p>
<p>A promise that is either fulfilled or rejected is called &#x201C;settled&#x201D;, as opposed to an initially &#x201C;pending&#x201D; promise.</p>
<h2 id="To-be-noted-fundamental"><a href="#To-be-noted-fundamental" class="headerlink" title="To be noted (fundamental)"></a>To be noted (fundamental)</h2><ol>
<li><strong>There can be only a single result or an error</strong></li>
</ol>
<p>The executor should call only one <code>resolve</code> or one <code>reject</code>. <strong>Any state change is final.</strong></p>
<p>All further calls of <code>resolve</code> and <code>reject</code> are ignored:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;&#x2026;&quot;</span>)); <span class="comment">// ignored</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;&#x2026;&quot;</span>)); <span class="comment">// ignored</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>Also, <code>resolve</code>/<code>reject</code> expect only one argument <strong>(or none)</strong> and will ignore additional arguments.</p>
<ol start="2">
<li><p><strong>A good habit:Reject with</strong> <code>Error</code> <strong>objects</strong></p>
<p>In case something goes wrong, the executor should call <code>reject</code>. That can be done with any type of argument (just like <code>resolve</code>). But it is recommended to use <code>Error</code> objects (or objects that inherit from <code>Error</code>)<br>To explain: <code>reject(new Errror(&apos;wrong&apos;))</code> is better than <code>reject(&apos;wrong&apos;)</code></p>
</li>
<li><blockquote>
<p>[!NOTE]</p>
<p><strong>The</strong> <code>state</code> <strong>and</strong> <code>result</code> <strong>are internal</strong></p>
</blockquote>
<p>Which means :<code>state</code> and <code>result</code> of the Promise object can&#x2019;t be directly accessed.Accessing has to be done bymethods <code>.then</code>/<code>.catch</code>/<code>.finally</code> &#xFF08;They are described below.&#xFF09;</p>
</li>
</ol>
<h2 id="Consumers-then-catch"><a href="#Consumers-then-catch" class="headerlink" title="Consumers:then catch"></a>Consumers:then catch</h2><p>As you might have comprehensed by now: A Promise object <strong>serves as a link</strong> between the executor (the &#x201C;producing code&#x201D; or &#x201C;singer&#x201D;) and the consuming functions (the &#x201C;fans&#x201D;) which will receive the result or error.It actually bond these two togther <strong>by something.</strong></p>
<p>Something(mentioned above) is methods <code>.then</code> and <code>.catch</code>.</p>
<h3 id="then"><a href="#then" class="headerlink" title="then"></a>then</h3><p>The syntax is:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">result</span>) {</span><br><span class="line">    <span class="comment">/* handle a successful result */</span></span><br><span class="line">  },</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="comment">/* handle an error */</span></span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>See? The promise comes from a producing code (executor)<br>(In case you forget):</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">  <span class="comment">// executor (the producing code, &quot;singer&quot;)</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>And it serves as a link And it uses then/catch methods to connect with the consuming functions (that desperate to receive a result or a error)<br>You can see the consuming functions as the one above</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">result</span>) { <span class="comment">/* handle a successful result */</span> },</span><br><span class="line"><span class="keyword">function</span>(<span class="params">error</span>) { <span class="comment">/* handle an error */</span> }</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]</p>
<p>the then methods <strong>could</strong> specify two functions:1.one for the success result 2. one for the rejected error</p>
</blockquote>
<blockquote>
<p>[!TIP]</p>
<p>If we&#x2019;re interested to see successful completions(what&#x2019;s in resolve)<br>we can provide only one function argument to <code>.then</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;done!&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(alert); <span class="comment">// shows &quot;done!&quot; after 1 second</span></span><br></pre></td></tr></table></figure>

<p>because in then handler <strong>promise.result</strong> is passed as paramter</p>
</blockquote>
<h3 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h3><p>catch only for error</p>
<p>If we&#x2019;re interested only in errors, then we can use <code>null</code> as the first argument: <code>.then(null, errorHandlingFunction)</code>. Or we can use <code>.catch(errorHandlingFunction)</code>, which is exactly the same:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Whoops!&quot;</span>)), <span class="number">1000</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// .catch(f) is the same as promise.then(null, f)</span></span><br><span class="line">promise.<span class="title function_">catch</span>(alert); <span class="comment">// shows &quot;Error: Whoops!&quot; after 1 second</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!CAUTION]</p>
<p>The call <code>.catch(f)</code> is a complete analog of <code>.then(null, f)</code>, it&#x2019;s just a shorthand.</p>
</blockquote>
<h2 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h2><p>The call <code>.finally(f)</code> is similar to <code>.then(f, f)</code> in the sense that <code>f</code> runs always, when the promise is settled: be it resolve or reject.</p>
<h3 id="Why-need-finally"><a href="#Why-need-finally" class="headerlink" title="Why need finally"></a>Why need finally</h3><p>The idea of <code>finally</code> is to set up a handler for performing cleanup/finalizing after the previous operations are complete.<br><code>finally</code> &#x7684;&#x60F3;&#x6CD5;&#x662F;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x524D;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x6267;&#x884C;&#x6E05;&#x7406;/&#x7EC8;&#x7ED3;&#x3002;<br>Because in real-life code after promise is produced,something should be close or clean up.</p>
<blockquote>
<p>[!NOTE]</p>
<p>a handler is function in promise-chain but a object in Proxy(,handler) Its translation in Chinese is &#x201C;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x201D;</p>
</blockquote>
<p>E.g. stopping loading indicators, closing no longer needed connections, etc.</p>
<p>Think of it as a party finisher. No matter was a party good or bad, how many friends were in it, we still need (or at least should) do a cleanup after it.</p>
<h3 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">  <span class="comment">/* do something that takes time, and then call resolve or maybe reject */</span></span><br><span class="line">})</span><br><span class="line">  <span class="comment">// runs when the promise is settled, doesn&apos;t matter successfully or not</span></span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> stop loading indicator)</span><br><span class="line">  <span class="comment">// so the loading indicator is always stopped before we go on</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> show result, <span class="function"><span class="params">err</span> =&gt;</span> show error)</span><br></pre></td></tr></table></figure>

<h3 id="Differences-between-finally-f-and-then-f-f"><a href="#Differences-between-finally-f-and-then-f-f" class="headerlink" title="Differences between finally(f) and then(f,f)"></a>Differences between finally(f) and then(f,f)</h3><ol>
<li><p>A <code>finally</code> handler has no arguments.</p>
<blockquote>
<p>[!NOTE]</p>
<p>In <code>finally</code> we don&#x2019;t know and we shouldn&#x2019;t know whether the promise is successful or not.</p>
</blockquote>
<p>That&#x2019;s all right, as our task is usually to perform &#x201C;general&#x201D; <strong>finalizing</strong> procedures.(=producing promise procedure cause when you created the state-change is <strong>final</strong>)</p>
<p>take a look at the example above: as you can see, the <code>finally</code> handler has no arguments, and the promise outcome is handled by the next handler.</p>
</li>
<li><p>A <code>finally</code> handler <strong>&#x201C;passes through&#x201D;</strong> the result or error to the next suitable handler.</p>
<p>For instance, here the result is passed through <code>finally</code> to <code>then</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;value&quot;</span>), <span class="number">2000</span>);</span><br><span class="line">})</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&quot;Promise ready&quot;</span>)) <span class="comment">// triggers first</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="title function_">alert</span>(result)); <span class="comment">// &lt;-- .then shows &quot;value&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><blockquote>
<p>[!IMPORTANT]</p>
<p>That&#x2019;s very convenient, because <code>finally</code> is <strong>not meant to</strong> process a promise result (the treasure produced). As said, it&#x2019;s a place to do generic cleanup, no matter what the outcome was.</p>
</blockquote>
</li>
<li><p>A <code>finally</code> handler also shouldn&#x2019;t return anything. If it does, the returned value is silently ignored.</p>
<blockquote>
<p>[!WARNING]</p>
<p>The only exception to this rule is when a <code>finally</code> handler throws an error. Then this error goes to the next handler, instead of any previous outcome.</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>[!IMPORTANT]</p>
<p>Sum up finally :<br>finally is <strong>just</strong> a dutiful cleaner lady.<br>Only pass promise.result and clean<br>don&#x2019;t receive (paramter) don&#x2019;t return don&#x2019;t know (what&#x2019;s going on about promise)<br>it runs regardlessly and ensures that a piece of code executes no matter what the outcome of the promise is.<br>But If cleaning-machine malfunctions throw a Error</p>
</blockquote>
<blockquote>
<p>[!TIP]</p>
<h2 id="handlers"><a href="#handlers" class="headerlink" title="handlers"></a>handlers</h2><p>To supplementary: finally and then-catch (which means all handlers)all operate on Promise object<br>And The premise that they run is Promise object which just produced,or you can say the state of Promise object is settled<br>In below&#x2019;s case they run immediately</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// the promise becomes resolved immediately upon creation</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;done!&quot;</span>));</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(alert); <span class="comment">// done! (shows up right now)</span></span><br></pre></td></tr></table></figure>

<p>Note that this makes promises more powerful than the real life &#x201C;subscription list&#x201D; scenario. If the singer has already released their song before a person signs up on the subscription list, they probably won&#x2019;t receive that song. Subscriptions in real life must be done prior to the event.<br>&#x8BA2;&#x9605;&#x53D1;&#x751F;&#x5728;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x4E4B;&#x524D;</p>
</blockquote>
<blockquote>
<p>[!IMPORTANT]</p>
<p>Sum up handler:<br>1.operate on Promise object<br>2.when &#x201C;.handler&#x201D; &#x2018;s front is a promise fully formed,handler runs immediately</p>
</blockquote>
<h2 id="eg1-loadScript"><a href="#eg1-loadScript" class="headerlink" title="eg1:loadScript"></a>eg1:loadScript</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src, callback</span>) {</span><br><span class="line">  <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">  script.<span class="property">src</span> = src;</span><br><span class="line"></span><br><span class="line">  script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="literal">null</span>, script); <span class="comment">//The moment when script loads successfully the callback runs</span></span><br><span class="line">  script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Script load error for <span class="subst">${src}</span>`</span>)); <span class="comment">//The moment when script loads fail</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">append</span>(script);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]</p>
<ol>
<li>the onload and onerror methods of A script element (Actually HTML-Element is built-in object) implies what will happen when script loads successfully or fail</li>
<li>To put callback directly in this position(right after &#x201C;()=&gt;&#x201D;) doesn&#x2019;t invoke the callback immediately; it just assigns it as the handler for the event.So when the event occurs callback is invoked automatically</li>
</ol>
</blockquote>
<p>Let&#x2019;s rewrite it using Promises.</p>
<p>The new function <code>loadScript</code> will not require a callback. Instead, it will create and return a Promise object that resolves when the loading is complete. The outer code can add handlers (subscribing functions) to it using <code>.then</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src</span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    script.<span class="property">src</span> = src;</span><br><span class="line"></span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(script);</span><br><span class="line">    script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Script load error for <span class="subst">${src}</span>`</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">append</span>(script);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title function_">loadScript</span>(</span><br><span class="line">  <span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">script</span>) =&gt;</span> <span class="title function_">alert</span>(<span class="string">`<span class="subst">${script.src}</span> is loaded!`</span>),</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="title function_">alert</span>(<span class="string">`Error: <span class="subst">${error.message}</span>`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">script</span>) =&gt;</span> <span class="title function_">alert</span>(<span class="string">&quot;Another handler...&quot;</span>));</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">Promises</th>
<th align="left">Callbacks</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Promises allow us to do things in the natural order. First, we run <code>loadScript(script)</code>, and <code>.then</code> we write what to do with the result.</td>
<td align="left">We must have a <code>callback</code> function at our disposal when calling <code>loadScript(script, callback)</code>. In other words, we must know what to do with the result <em>before</em> <code>loadScript</code> is called.</td>
</tr>
<tr>
<td align="left">We can call <code>.then</code> on a Promise as many times as we want. Each time, we&#x2019;re adding a new &#x201C;fan&#x201D;, a new subscribing function, to the &#x201C;subscription list&#x201D;.</td>
<td align="left">There can be only one callback.</td>
</tr>
</tbody></table>
<h2 id="eg2-delay-using-promise"><a href="#eg2-delay-using-promise" class="headerlink" title="eg2:delay using promise"></a>eg2:delay using promise</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">delay</span>(<span class="params">ms</span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">delay</span>(<span class="number">3000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&quot;runs after 3 seconds&quot;</span>));</span><br></pre></td></tr></table></figure>

<h1 id="To-supplementay"><a href="#To-supplementay" class="headerlink" title="To supplementay"></a>To supplementay</h1><p>For a Promise<br>the state change of a Promise is a one-time thing.<br>And there are only two results:alive or dead<br>fulfilled or rejected</p>
]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Promise</tag>
      </tags>
  </entry>
  <entry>
    <title>Proxy</title>
    <url>/2024/08/19/2024-08-19-Proxy-2024/</url>
    <content><![CDATA[<h1 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h1><h2 id="what&#x2019;s-a-proxy"><a href="#what&#x2019;s-a-proxy" class="headerlink" title="what&#x2019;s a proxy"></a>what&#x2019;s a proxy</h2><p>a proxy is a object with a superpower of wrapping another object Like a trash wrapper <br></p>
<span id="more"></span>

<p>Not only wrap it but also protect it . The protecting way is to intercept the operations that are about to operate on the object that been wrapped inside For example reading/writing properties <br><br><strong>optionally handling them on Proxy&#x2019;s own</strong></p>
<h2 id="Proxy-syntax"><a href="#Proxy-syntax" class="headerlink" title="Proxy syntax"></a>Proxy syntax</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let` proxy `=` `new` `Proxy``(`target`,` handler`)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>target</code> &#x2013; is an object to wrap, can be anything, including functions.</li>
<li><code>handler</code> &#x2013; proxy configuration: an object with &#x201C;traps&#x201D;, methods that intercept operations. &#x2013; e.g. <code>get</code> trap for reading a property of <code>target</code>, <code>set</code> trap for writing a property into <code>target</code>, and so on.</li>
</ul>
<p>For operations on <code>proxy</code>, if there&#x2019;s a corresponding trap in <code>handler</code>, then it runs<br>otherwise the operation is performed <strong>directly</strong> on <code>target</code>.</p>
<h3 id="A-proxy-with-no-&#x201C;traps&#x201D;-can-be-seen-as-the-object-inside-itself-OR-without-any-traps-proxy-is-a-transparent-wrapper-around-target"><a href="#A-proxy-with-no-&#x201C;traps&#x201D;-can-be-seen-as-the-object-inside-itself-OR-without-any-traps-proxy-is-a-transparent-wrapper-around-target" class="headerlink" title="A proxy with no &#x201C;traps&#x201D; can be seen as the object(inside) itself OR without any traps, proxy is a transparent wrapper around target"></a>A proxy with no &#x201C;traps&#x201D; can be seen as the object(inside) itself OR without any traps, <code>proxy</code> is a transparent wrapper around <code>target</code></h3><p>Below is the demonstration</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let target = {};</span><br><span class="line">let proxy = new Proxy(target, {});</span><br><span class="line">proxy.test = 5; //set to proxy also set to target</span><br><span class="line">console.log(&quot;target.test is &quot;, target.test);</span><br></pre></td></tr></table></figure>

<p>As there are no traps, all operations on <code>proxy</code> are forwarded to <code>target</code>.</p>
<h3 id="What-can-we-intercept"><a href="#What-can-we-intercept" class="headerlink" title="What can we intercept"></a>What can we intercept</h3><p>For a object there are some so-called &#x201C;internal method&#x201D;<br><code>[[Get]]</code>, the internal method to read a property,<br><code>[[Set]]</code>, the internal method to write a property,</p>
<p><strong>Proxy traps intercept invocations of these methods</strong></p>
<p>They are listed in the <a href="https://tc39.es/ecma262/#sec-proxy-object-internal-methods-and-internal-slots">Proxy specification</a> and in the table below.</p>
<h2 id="Internal-Method-and-handler-methods-and-Trigger-point"><a href="#Internal-Method-and-handler-methods-and-Trigger-point" class="headerlink" title="Internal Method and handler methods and Trigger-point"></a>Internal Method and handler methods and Trigger-point</h2><p><strong>For every internal method, there&#x2019;s a trap in this table: the name of the method that we can add to the <code>handler</code> parameter of <code>new Proxy</code> to intercept the operation</strong></p>
<h4 id="To-note"><a href="#To-note" class="headerlink" title="To note"></a>To note</h4><p>handler is a paramter in Proxy&#x2019;s constructor.It&#x2019;s a set including all the methods(we can call them Handler Methods)<br>And what&#x2019;s actually intercepting the specific operation?THE corresponding handler method!<br>How?When you trigger the internal method in THE object.</p>
<table>
<thead>
<tr>
<th align="left">Internal Method In object &#x5185;&#x90E8;&#x65B9;&#x6CD5;</th>
<th align="left">Handler Method In proxy &#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x65B9;&#x6CD5;</th>
<th align="left">Triggers when&#x2026; &#x89E6;&#x53D1;&#x65F6;&#x2026;</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>[[Get]]</code></td>
<td align="left"><code>get</code></td>
<td align="left">reading a property &#x8BFB;&#x53D6;&#x5C5E;&#x6027; use [ ] or . on a object</td>
</tr>
<tr>
<td align="left"><code>[[Set]]</code></td>
<td align="left"><code>set</code></td>
<td align="left">writing to a property &#x5199;&#x5165;&#x5C5E;&#x6027; .newproperty = /.push(for array) /unshift</td>
</tr>
<tr>
<td align="left"><code>[[HasProperty]]</code></td>
<td align="left"><code>has</code></td>
<td align="left"><code>in</code> operator <code>in</code> &#x8FD0;&#x7B97;&#x7B26;</td>
</tr>
<tr>
<td align="left"><code>[[Delete]]</code></td>
<td align="left"><code>deleteProperty</code></td>
<td align="left"><code>delete</code> operator <code>delete</code> &#x8FD0;&#x7B97;&#x7B26;</td>
</tr>
<tr>
<td align="left"><code>[[Call]]</code></td>
<td align="left"><code>apply</code></td>
<td align="left">function call &#x51FD;&#x6570;&#x8C03;&#x7528;</td>
</tr>
<tr>
<td align="left"><code>[[Construct]]</code></td>
<td align="left"><code>construct</code></td>
<td align="left"><code>new</code> operator <code>new</code> &#x8FD0;&#x7B97;&#x7B26;</td>
</tr>
<tr>
<td align="left"><code>[[GetPrototypeOf]]</code></td>
<td align="left"><code>getPrototypeOf</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf">Object.getPrototypeOf &#x5BF9;&#x8C61;.getPrototypeOf</a></td>
</tr>
<tr>
<td align="left"><code>[[SetPrototypeOf]]</code></td>
<td align="left"><code>setPrototypeOf</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf">Object.setPrototypeOf &#x5BF9;&#x8C61;.setPrototypeOf</a></td>
</tr>
<tr>
<td align="left"><code>[[IsExtensible]]</code></td>
<td align="left"><code>isExtensible</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible">Object.isExtensible &#x5BF9;&#x8C61;&#x53EF;&#x6269;&#x5C55;</a></td>
</tr>
<tr>
<td align="left"><code>[[PreventExtensions]]</code></td>
<td align="left"><code>preventExtensions</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions">Object.preventExtensions &#x5BF9;&#x8C61;.preventExtensions</a></td>
</tr>
<tr>
<td align="left"><code>[[DefineOwnProperty]]</code></td>
<td align="left"><code>defineProperty</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties">Object.defineProperties</a> &#x5BF9;&#x8C61;.defineProperty, &#x5BF9;&#x8C61;.defineProperties</td>
</tr>
<tr>
<td align="left"><code>[[GetOwnProperty]]</code></td>
<td align="left"><code>getOwnPropertyDescriptor</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">Object.getOwnPropertyDescriptor</a>, <code>for..in</code>, <code>Object.keys/values/entries</code> Object.getOwnPropertyDescriptor&#xFF0C; <code>for..in</code> &#xFF0C; <code>Object.keys/values/entries</code></td>
</tr>
<tr>
<td align="left"><code>[[OwnPropertyKeys]]</code></td>
<td align="left"><code>ownKeys</code></td>
<td align="left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols</a>, <code>for..in</code>, <code>Object.keys/values/entries</code> Object.getOwnPropertyNames&#x3001;Object.getOwnPropertySymbols&#x3001; <code>for..in</code> &#x3001; <code>Object.keys/values/entries</code></td>
</tr>
</tbody></table>
<h4 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h4><ul>
<li><code>[[Set]]</code> must return <code>true</code> if the value was written successfully, otherwise <code>false</code>.</li>
<li><code>[[Delete]]</code> must return <code>true</code> if the value was deleted successfully, otherwise <code>false</code>.</li>
</ul>
<h3 id="How-to-set-the-handler"><a href="#How-to-set-the-handler" class="headerlink" title="How to set the handler"></a>How to set the handler</h3><p>To intercept reading, the <code>handler</code> should have the so-called handler-method <code>get(target, property, receiver)</code> As we mentioned: <strong>It triggers when a property is read</strong></p>
<ul>
<li><code>target</code> &#x2013; is the target object, the one passed as the first argument to <code>new Proxy</code>,</li>
<li><code>property</code> &#x2013; the object&#x2019;s property(the key in a key-value pair),</li>
<li><code>receiver</code> &#x2013; if the target property is a getter, then <code>receiver</code> is the object that&#x2019;s going to be used as <code>this</code> in its call. Usually that&#x2019;s the <code>proxy</code> object itself (or an object that inherits from it, if we inherit from proxy). Right now we don&#x2019;t need this argument, so it will be explained in more detail later.</li>
</ul>
<h4 id="eg1"><a href="#eg1" class="headerlink" title="eg1"></a>eg1</h4><p>Usually when one tries to get a non-existing array item, they get <code>undefined</code>, but we&#x2019;ll wrap a regular array into the proxy that traps reading and returns <code>0</code> if there&#x2019;s no such property:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(number, {</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, prop</span>) {</span><br><span class="line">    <span class="keyword">if</span> (prop <span class="keyword">in</span> target) {</span><br><span class="line">      <span class="keyword">return</span> target[prop];</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>there should be a supplement For array : if array is seen as a object {key&#xFF1A;value}The &#x6570;&#x7EC4;&#x7684;&#x7D22;&#x5F15; is the key The &#x5177;&#x4F53;&#x6570;&#x503C; &#x662F; value</p>
<h4 id="eg2"><a href="#eg2" class="headerlink" title="eg2"></a>eg2</h4><p>Let&#x2019;s say we want an array exclusively for numbers. If a value of another type is added, there should be an error.</p>
<p><strong>The <code>set</code> trap triggers when a property is written.</strong></p>
<p><code>set(target, property, value, receiver)</code>:</p>
<ul>
<li><code>target</code> &#x2013; is the target object, the one passed as the first argument to <code>new Proxy</code>,</li>
<li><code>property</code> &#x2013; property name,</li>
<li><code>value</code> &#x2013; property value,</li>
<li><code>receiver</code> &#x2013; similar to <code>get</code> trap, matters only for setter properties.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [];</span><br><span class="line"></span><br><span class="line">numbers = <span class="keyword">new</span> <span class="title class_">Proxy</span>(numbers, {</span><br><span class="line">  <span class="comment">// (*)</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, prop, val</span>) {</span><br><span class="line">    <span class="comment">// to intercept property writing</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> val == <span class="string">&quot;number&quot;</span>) {</span><br><span class="line">      target[prop] = val;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//For set, it must return true for a successful write.</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="number">1</span>); <span class="comment">// added successfully</span></span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="number">2</span>); <span class="comment">// added successfully</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;Length is: &quot;</span> + numbers.<span class="property">length</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="string">&quot;test&quot;</span>); <span class="comment">// TypeError (&apos;set&apos; on proxy returned false)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;This line is never reached (error in the line above)&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>For <code>set</code>, it must return <code>true</code> for a successful write.</strong></p>
<h3 id="Note-Only-interact-with-the-proxy-object"><a href="#Note-Only-interact-with-the-proxy-object" class="headerlink" title="Note : Only interact with the proxy object"></a>Note : Only interact with the proxy object</h3><h4 id="You-should-follow-below"><a href="#You-should-follow-below" class="headerlink" title="You should follow below:"></a>You should follow below:</h4><p>When a proxy object is created <strong>As for</strong> when you have proxied an object<br>You shouldn&#x2019;t reference the origin(or target) object.(the object is past the moment you get the proxy version)<br>And below is a normal way we deal with it.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dictionary = new Proxy(dictionary, ...);</span><br></pre></td></tr></table></figure>

<p>can overwrite the &#x201C;dictionary&#x201D; variable .</p>
<h4 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h4><p>Usually When you created a proxy You got to devise some traps . And so it&#x2019;s important for you to make sure the defined behaviors and traps are constantly applied to ensure all operation go through the proxy and its traps</p>
<h2 id="iteration"><a href="#iteration" class="headerlink" title="iteration"></a>iteration</h2><h3 id="OwnPropertyKeys-internal-method"><a href="#OwnPropertyKeys-internal-method" class="headerlink" title="[[OwnPropertyKeys]] internal method"></a><code>[[OwnPropertyKeys]]</code> internal method</h3><p><code>Object.keys</code>, <code>for..in</code> loop and most other methods that iterate over object properties (use <code>[[OwnPropertyKeys]]</code> internal method) (intercepted by <code>ownKeys</code> trap) to** get a list of properties**</p>
<h4 id="Such-methods-differ-in-details"><a href="#Such-methods-differ-in-details" class="headerlink" title="Such methods differ in details:"></a>Such methods differ in details:</h4><ul>
<li><code>Object.getOwnPropertyNames(obj)</code> returns non-symbol keys.</li>
<li><code>Object.getOwnPropertySymbols(obj)</code> returns symbol keys.</li>
<li><code>Object.keys/values()</code> returns non-symbol keys/values with <code>enumerable</code> flag (property flags were explained in the article <a href="https://javascript.info/property-descriptors">Property flags and descriptors</a>).</li>
<li><code>for..in</code> loops over non-symbol keys with <code>enumerable</code> flag, and also prototype keys.</li>
</ul>
<h4 id="to-supplement"><a href="#to-supplement" class="headerlink" title="to supplement:"></a>to supplement:</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>()&#xFF1A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x8BE5;&#x6570;&#x7EC4;&#x5305;&#x542B;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#xFF08;&#x4E0D;&#x5305;&#x62EC;&#x539F;&#x578B;&#x94FE;&#xFF09;&#x7684;&#x6240;&#x6709;&#x53EF;&#x679A;&#x4E3E;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span><br><span class="line"><span class="keyword">const</span> obj = { <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> };</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)); <span class="comment">// &#x8F93;&#x51FA;&#xFF1A;[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span></span><br><span class="line"><span class="keyword">for</span>...<span class="keyword">in</span> &#x5FAA;&#x73AF;&#xFF1A;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x7684;&#x548C;&#x7EE7;&#x627F;&#x7684;&#x6240;&#x6709;&#x53EF;&#x679A;&#x4E3E;&#x5C5E;&#x6027;&#xFF08;&#x5305;&#x62EC;&#x539F;&#x578B;&#x94FE;&#xFF09;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span><br><span class="line"><span class="keyword">const</span> obj = { <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> };</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x8F93;&#x51FA;&#xFF1A;&quot;a&quot;&#xFF0C;&quot;b&quot;&#xFF0C;&quot;c&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="eg3"><a href="#eg3" class="headerlink" title="eg3"></a>eg3</h3><p>In the example below we use <code>ownKeys</code> trap to make <code>for..in</code> loop over <code>user</code>, and also <code>Object.keys</code> and <code>Object.values</code>, to skip properties starting with an underscore `_</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">_password</span>: <span class="string">&quot;***&quot;</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">  <span class="title function_">ownKeys</span>(<span class="params">target</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">filter</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> !key.<span class="title function_">startsWith</span>(<span class="string">&quot;_&quot;</span>));</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;ownKeys&quot; filters out _password</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) <span class="title function_">alert</span>(key); <span class="comment">// name, then: age</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// same effect on these methods:</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(user)); <span class="comment">// name,age</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(user)); <span class="comment">// John,30</span></span><br></pre></td></tr></table></figure>

<p><strong>To articulate</strong></p>
<p>No matter &#x201C;for in&#x201D; &#x201C;Object.keys&#x201D; or &#x201C;Object.values&#x201D;<br>Deep inside They still use the same list offered by [[OwnPropertyKeys]]<br>Different methods <strong>just filter the list with different ways.</strong> And &#x201C;ownKeys&#x201D; trap does something to the list (above:Object.keys(target).filter(key =&gt; !key.startsWith(&#x2018;_&#x2018;));)<br> <strong>before</strong> the &#x201C;for in&#x201D; &#x201C;Object.keys&#x201D; or &#x201C;Object.values&#x201D; can access the list.</p>
<h4 id="To-note-1"><a href="#To-note-1" class="headerlink" title="To note"></a>To note</h4><p>if we return a key that doesn&#x2019;t exist in the object, <code>Object.keys</code> won&#x2019;t list it:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {};</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">  <span class="title function_">ownKeys</span>(<span class="params">target</span>) {</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>];</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(user)); <span class="comment">// &lt;empty&gt;</span></span><br></pre></td></tr></table></figure>

<p>the trap return a list full of keys But none of these keys exist in the &#x201C;user &#x201C;object<br><strong>Why?</strong> The reason is simple: <code>Object.keys</code> returns only properties <strong>with the <code>enumerable</code> flag.</strong></p>
<p>the properties of [&#x2018;a&#x2019;, &#x2018;b&#x2019;, &#x2018;c&#x2019;] don&#x2019;t have the flag But how does Object.keys find out?<br>Object.keys check for it by calling the internal method <code>[[GetOwnProperty]]</code> of &#x201C;user&#x201D; for every property to get its <strong>descriptor</strong><br>And here, as there&#x2019;s no property in user, its descriptor is empty, no <code>enumerable</code> flag, so the listing-properties procedure is skipped.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {};</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">  <span class="title function_">ownKeys</span>(<span class="params">target</span>) {</span><br><span class="line">    <span class="comment">// called once to get a list of properties</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>];</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getOwnPropertyDescriptor</span>(<span class="params">target, prop</span>) {</span><br><span class="line">    <span class="comment">// called for every property</span></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">/* ...other flags, probable &quot;value:...&quot; */</span></span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(user)); <span class="comment">// a, b, c</span></span><br></pre></td></tr></table></figure>

<p>when Object.keys is checking by calling the internal method <code>[[GetOwnProperty]]</code>of &#x201C;user&#x201D;<br>the calling will be intercepted and Object.keys will receive the informing-letter(haha) which is written &#x201C;it&#x2019;s enumable&#x201D;</p>
<h2 id="Convention"><a href="#Convention" class="headerlink" title="Convention"></a>Convention</h2><ol>
<li>There&#x2019;s a widespread convention that properties and methods prefixed by an underscore <code>_</code> are internal. They shouldn&#x2019;t be accessed from outside the object.</li>
<li>(prop can be seen as a key in the wrapped object&#x2019;s key-value pair)</li>
<li>target in &#x201C;get(target,prop)&#x201D; is the original object</li>
</ol>
<h2 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty"></a>deleteProperty</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">_password</span>: <span class="string">&quot;secret&quot;</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">_password</span>); <span class="comment">// secret</span></span><br></pre></td></tr></table></figure>

<h3 id="eg4"><a href="#eg4" class="headerlink" title="eg4"></a>eg4</h3><p>Let&#x2019;s use proxies to prevent any access to properties starting with <code>_</code>.</p>
<p>We&#x2019;ll need these traps to accomplish an internal property:</p>
<ul>
<li><code>get</code> to throw an error when reading such property,</li>
<li><code>set</code> to throw an error when writing,</li>
<li><code>deleteProperty</code> to throw an error when deleting,</li>
<li><code>ownKeys</code> to exclude properties starting with <code>_</code> from <code>for..in</code> and methods like <code>Object.keys</code>.</li>
</ul>
<p>here is how we approach that:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">_password</span>: <span class="string">&quot;***&quot;</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, prop</span>) {</span><br><span class="line">    <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&quot;_&quot;</span>)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Access denied&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">let</span> value = target[prop];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span> ? value.<span class="title function_">bind</span>(target) : value; <span class="comment">// (*)</span></span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, prop, val</span>) {</span><br><span class="line">    <span class="comment">// to intercept property writing</span></span><br><span class="line">    <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&quot;_&quot;</span>)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Access denied&quot;</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      target[prop] = val;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) {</span><br><span class="line">    <span class="comment">// to intercept property deletion</span></span><br><span class="line">    <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&quot;_&quot;</span>)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Access denied&quot;</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">delete</span> target[prop];</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">ownKeys</span>(<span class="params">target</span>) {</span><br><span class="line">    <span class="comment">// to intercept property list</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">filter</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> !key.<span class="title function_">startsWith</span>(<span class="string">&quot;_&quot;</span>));</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;get&quot; doesn&apos;t allow to read _password</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">  <span class="title function_">alert</span>(user.<span class="property">_password</span>); <span class="comment">// Error: Access denied</span></span><br><span class="line">} <span class="keyword">catch</span> (e) {</span><br><span class="line">  <span class="title function_">alert</span>(e.<span class="property">message</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;set&quot; doesn&apos;t allow to write _password</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">  user.<span class="property">_password</span> = <span class="string">&quot;test&quot;</span>; <span class="comment">// Error: Access denied</span></span><br><span class="line">} <span class="keyword">catch</span> (e) {</span><br><span class="line">  <span class="title function_">alert</span>(e.<span class="property">message</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;deleteProperty&quot; doesn&apos;t allow to delete _password</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">  <span class="keyword">delete</span> user.<span class="property">_password</span>; <span class="comment">// Error: Access denied</span></span><br><span class="line">} <span class="keyword">catch</span> (e) {</span><br><span class="line">  <span class="title function_">alert</span>(e.<span class="property">message</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;ownKeys&quot; filters out _password</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) <span class="title function_">alert</span>(key); <span class="comment">// name</span></span><br></pre></td></tr></table></figure>

<p>To explain:</p>
<ol>
<li><p>get: the throwing-error part is obvious But why do we need to return a function binded to the object &#x201C;target&#x201D;when what we try to use[[Get]] to get is a function<br>Because:<br>In real-life code there will absolutely be a method in the <em>original object</em> that can access the internal value(_ prefixed)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user = {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="title function_">checkPassword</span>(<span class="params">value</span>) {</span><br><span class="line">    <span class="comment">// object method must be able to read _password</span></span><br><span class="line">    <span class="keyword">return</span> value === <span class="variable language_">this</span>.<span class="property">_password</span>;</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>for example <em>above</em> should be working properly! But with the trap &#x201C;get&#x201D; is set already when you write user.checkPassword &#x201C;this._password&#x201D; will activate the trap which will deny your access So the checkPassword won&#x2019;t be working.<br>After you set &#x201C;value.bind(target)&#x201D; actually you are bonding the context of the method(signing &#x201C;this&#x201D; to the) to target (we know it&#x2019;s the original object) And in the target(the original object) there are no traps at all.<br><strong>To be more clear : You need to ensure when &#x201C;checkPassword&#x201D; is working its(&#x201C;checkPassword&#x201D;) &#x201C;this&#x201D; should point to the &#x201C;obedient&#x201D;(no traps)object to ensure it (&#x201C;checkPassword&#x201D;) functions!(&#x8D77;&#x4F5C;&#x7528;)</strong></p>
</li>
</ol>
<p>That solution usually works, but isn&#x2019;t ideal</p>
<ol start="2">
<li>the rest is simple</li>
</ol>
<h2 id="In-to-has-trap"><a href="#In-to-has-trap" class="headerlink" title="In to has trap"></a>In to has trap</h2><p>As you can see above(in the internal method and handler method). The has trap intercept the &#x201C;in&#x201D; operator(which operate on the proxy object)because the in operator will invoke the <code>[[HasProperty]]</code></p>
<h3 id="eg5"><a href="#eg5" class="headerlink" title="eg5"></a>eg5</h3><p>We&#x2019;d like to use the <code>in</code> operator to check that a number is in <code>range</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">  <span class="attr">start</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">end</span>: <span class="number">10</span>,</span><br><span class="line">};</span><br><span class="line">proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(range, {</span><br><span class="line">  <span class="title function_">has</span>(<span class="params">target, prop</span>) {</span><br><span class="line">    <span class="keyword">return</span> prop &gt;= target.<span class="property">start</span> &amp;&amp; prop &lt;= target.<span class="property">end</span>;</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span> <span class="keyword">in</span> proxy); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h2 id="Wrapping-functions-&#x201D;apply&#x201D;"><a href="#Wrapping-functions-&#x201D;apply&#x201D;" class="headerlink" title="Wrapping functions:&#x201D;apply&#x201D;"></a>Wrapping functions:&#x201D;apply&#x201D;</h2><p>You should see the article Decortor and forwarding,call/apply first to understand this section</p>
]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>What happens when you type a URL into your browser?</title>
    <url>/2024/10/15/2024-10-15-How-browser-retrieve-your-website-2024/</url>
    <content><![CDATA[<p>In the modern age of the internet, where accessing information is just a click away, the journey of a URL from the moment it&#x2019;s typed into the browser to the display of the desired webpage is <strong>an intricate process</strong> involving various components of the web stack.</p>
<h1 id="DNS-Look-up"><a href="#DNS-Look-up" class="headerlink" title="DNS Look up"></a>DNS Look up</h1><p>Your browser first channels the Domain Name System (DNS) to translate the human-readable URL (like <a href="http://www.example.com/">www.example.com</a>) into an IP address (e.g., 123.456.78.90), which identifies the server where the website is hosted.<br><br>To make this lookup process fast, the DNS information is <strong>heavily cached.</strong><br>1.First the browser itself <strong>caches</strong> it for a short period of time. And if it is not in the browser&#x2019;s cache .The browser asks the operating system for it.<br>2.Also,The operating system itself has a <strong>cache</strong> for it&#x2026; which also keeps the answer for a short period of time.</p>
<p>if the operating operating system doesn&#x2019;t have it, it makes a query out to the internet <strong>to a DNS resolver.</strong> This sets off a <strong>chain</strong> of requests (Recursive lookup to the DNS Server ) until the IP address is <strong>resolved.</strong></p>
<h1 id="Using-IP-to-establish-TCP-connection"><a href="#Using-IP-to-establish-TCP-connection" class="headerlink" title="Using IP to establish TCP connection"></a>Using IP to establish TCP connection</h1><p>there&#x2019;s a <strong>handshake-process</strong> involved in establishing <strong>a TCP connection</strong>. It takes several network-round-trips for this to complete. To keep the loading process fast, modern browsers use something called a keep-alive connection to try to reuse an established TCP connection to the server as much as possible.</p>
<p>This handshake is expensive and the browsers use tricks like SSL session resumption to try to lower the cost. Finally, the browser sends an HTTP request to the server over the established TCP connection.</p>
<h1 id="HTTP-Request"><a href="#HTTP-Request" class="headerlink" title="HTTP Request"></a>HTTP Request</h1><p><strong>HTTP Request</strong>: After getting the IP address, the browser sends an HTTP request to the server asking for the website&#x2019;s content, like &#x201C;Hey, give me the page at this URL.&#x201D;</p>
<h1 id="Server-Response"><a href="#Server-Response" class="headerlink" title="Server Response"></a><strong>Server Response</strong></h1><p><strong>Server Response</strong>: The server processes the request and sends back a response, which usually includes the HTML, CSS, JavaScript, and sometimes images or videos that make up the website.</p>
<p>The browser receives the response and renders html content. Oftentimes there are additional resources to load, like javascript bundles and images.</p>
<h1 id="resource-fetching"><a href="#resource-fetching" class="headerlink" title="resource fetching."></a><strong>resource fetching.</strong></h1><p>The browser repeats the process above that we mentioned to finish fetching all the other resources.</p>
<p>When a browser receives the <strong>initial HTML content</strong>, it often contains <strong>links to</strong> other resources like JavaScript, CSS, and images. The browser then <strong>repeats</strong> the process of making <strong>additional HTTP requests</strong> to fetch each of those resources.</p>
<p>This entire flow of making multiple requests and processing them to fully load a website is called the <strong>&#x201C;resource loading process&#x201D;</strong> or <strong>&#x201C;resource fetching.&#x201D;</strong></p>
<p>To optimize this, browsers handle many of these requests <strong>in parallel</strong>, fetching multiple resources simultaneously to speed things up. So, even though many requests are made, they aren&#x2019;t strictly sequential; they happen concurrently, making the site load faster.</p>
<h1 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a><strong>Rendering</strong></h1><p><strong>Rendering</strong>: Your browser then takes this response and renders it, displaying the website visually for you to interact with.</p>
<hr>

<p>So basically, the browser is like a translator and a middleman between you and the server.</p>
]]></content>
      <categories>
        <category>Internet</category>
      </categories>
      <tags>
        <tag>Server</tag>
        <tag>http</tag>
        <tag>https</tag>
        <tag>domain</tag>
        <tag>Browser</tag>
        <tag>URL</tag>
      </tags>
  </entry>
  <entry>
    <title>Server</title>
    <url>/2024/10/07/2024-10-07-Server-2024/</url>
    <content><![CDATA[<h1 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h1><p>Browser is the middleman between you and Server.</p>
<p>A server is a provider that offers services . It can be visualize as a computer being open all the time 24/7.</p>
<span id="more"></span>

<p>the websites you visit and the webpages you view doesn&#x2019;t belong to the browser <br> It originally comes from server.</p>
<h1 id="IP-Domain-Port"><a href="#IP-Domain-Port" class="headerlink" title="IP Domain Port"></a>IP Domain Port</h1><p>Every server has a unique ip address to be differentiated But it&#x2019;s digits composed which makes it not readable <br> So domain shows up .<strong>Domain is example.com</strong></p>
<p><strong>So</strong> when you put a Domain on the browser&#x2019;s search bar The browser parses it into IP address (using DNS) in order to get you accessed to the right server</p>
<p>The protocols are well known as <strong>http and https</strong> <br>These are specifically created for <strong>webpage-transmit</strong> These two specify the <strong>rules</strong> that should be followed by both server and browser (client) during the transmission.</p>
<p>BUT website is just one of the many services that a server can provide and <strong>output by the specific port</strong> &#xFF08;80 443&#xFF09;</p>
<p>The Internet request when you are expecting a webpage is sent by the browser to the server<br>And To be concrete to port 80 /443 <strong>of</strong> the server(Biu!!!)</p>
<hr>

<p>I want to clarify that a server can host many services, not just websites, and each service typically runs on different ports.</p>
]]></content>
      <tags>
        <tag>Server</tag>
        <tag>http</tag>
        <tag>https</tag>
        <tag>domain</tag>
      </tags>
  </entry>
  <entry>
    <title>Stacks And Queues in DS</title>
    <url>/2024/10/19/Stack/</url>
    <content><![CDATA[<p><img src="https://imgur.com/cSzgXRO.png" alt="1"></p>
<h1 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h1><p>Stacks and queues are two <strong>special</strong> linear lists.<br>In terms of structure, both are linear lists, but in terms of operation, the basic operations they support are only a <strong>subset</strong> of linear list operations So they are linear lists with <strong>restricted</strong> operations.</p>
<h1 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h1><h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition:"></a>Definition:</h2><p>It is a linear list that allows insertion or deletion <strong>only</strong> at the <strong>end</strong> of the list.<br>The end that <strong>allows</strong> insertion and deletion is called the <strong>top</strong> of the stack, and the other side is called the bottom of the stack.</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Above gives it a feature : <strong>Last In First Out</strong> (LIFO)<br>The latest node added to a stack is the node which is eligible to be removed first.</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASQAAACtCAMAAAAu7/J6AAAAxlBMVEX///9qtf8A18es7+gAAABfsf9ks/+n0f+t1P+68ezO9fHy/Pvr+/kA282e7OVO4dV65t3g+fbe7f/U9/LX6P/m8P/v9P+z8Oq0tLSBv/+Rxv9cr//G8+/B3v/O5P/5//zFxcX19fW3t7fAwMCpqans7Ozc3Ny42f/Ozs7t7e3Z2dkQEBCfn58eHh49PT32+v92dnaUlJSYyv8vLy+CgoJgYGCJiYlsbGxNTU1CQkIYGBgqKipWVlY2NjZkZGR1u/+P6+Nm5dvIVK28AAALcklEQVR4nO2dbXuayhaGl+mAtml2W6sWpBoGBiQgosa3aIxn//8/dQbS3S2vA2gFzpnnQ3vJ5QPDzcxi1mIiAFxcXFxcXFxcXFxcXFxcXFxcXFxcXBXKsqtuQQNkEc2oug21lyVJko6rbkWdZVi65IuYVbekrsKWRKSAkvZUdVtqKqwSycbBcOPdKEW/47VlVdyS2uqJdx+mbKJW3YTayyJ8AsmSSvjskSXOiC2LM2LK4JNrpjC52bSIEE21i/ZaiWi6VdwkUdP18k9du9quWDJNW9WIpBY6ZSMwkcImi5r0K40R49YBCZt68VJMYCp6xtigedZVMGnqNfZSTE8qKZ5A4zJlLmqSLu8EBqmkcIT1EpGQJuAlTNbluYR+8R5KypS04pfHkKRSpsvqPri6KRLWSPG20x5YosHqZZMcU7rEfaFKTfStMid8WWqqqheYL1ZJSiVM9iV9Sas2+VfL3DZKUiodV/AV7o8XSS8z3NUS0ZuiLXsbxyVi53UlqSVMml7CVDqzwNXMks5UKrvG5Uxlc9SqGfmPZkqY7DIX16y8R5RXqQt8u1F6ue7v2d/5/BjdEP5oJ3Slx8/RLZENSb2CaTKSIjDLlKg83/mtL1/Z33n4K/z5413kCwmJ+l8PkQ2f7iKXQ4rPXX5Ed/zt7lt4gxbvtD+jpvu777EvRfXtrgilq0Cy4rcdNqSE/seGZJKYKQHSJ4DJMF2TSiAlFCLYkBImL2xIEJ9RJvakoSKmS5CrgJQw3tiQEnKFHJDi4y0J0kBoZUnp3x4SBt0CHO5MTEjYzzojJiYkDJaOI6YkSH0lBEUUxNBnoXtzSJgEq6HCl5gJSfJdkWoaE9K7KTwPyAFpMh6dxGoh0RDsK7yNCckMTAV7kkHiJiYk0fO3ymK1kECTYgta2DHJX2gWiUrsmKRSUyQqsSCJIxgrIxhVDcmQpOhUmA3pSZKiMwc2JBzrsuyeJLdbSrt6SKDHbuc57m7xgl2Ou1u8rMmOSaLchX7FgRv8J0zRLTkg4VgilgMSxEw5ArfsgVd5TEpQDkhx5YEUExOSoIjKEroCh3SmaODugUwh9Tmkc0UhTcDrAbQrGG6DpZyuUZ0gtYQRDUmd80TlRpC8jPxRFJVOnSDRrKSlhPIS5TaQRtkZpFgxJC+7eYJ3E0iTcMYYzSCVK0IaDDP67NJLLpVMFCG9UkI7egWQRLkX3nBNSK0w/0iXlVMqk/1Ruro3KrqFmAhLCN1hrwnpc1dpZUkZ1Ld8ew6J3mMhNFe7KqReaMd0rIRHttAUSO3B8kaQxGHX6y7PKTWlJ9HLO7wNJHFIJ2gAw7ODNwaS3/ibQBJ60FZGoYNzSLHhdpIFCqndSEiCDN3QnPbPBW464MbnWxoD6dTr0hwyFCn+GCR57DUzJp0GVN5NIMmi0obzTY2B1FIEqhsMN3EAQxqTxg2BNM6cB4unPwSpE0wB5IYMN1gGvSdN3T803IR2tz+WQylRnSFBf5wu73pFt1haIjQnLWHqalUAL3tgtxqzPilB1yuVjEQlXa0ehxRUJr1+uqA5K90SlAxp0E0XpELKNiVDyjJ5tYY0EdLviUqrmzLcskxiynAbi1mmcX0hPfZZk6vrBe6skq//IOB7bSGNGYv0ckwB4uebOAXIvhy3eqTEFBuSQBOxyNMDNiRBlFvhDTkgxU1NgUSjCYRTwByQaDTJVSqJPMGlG3tVLwdMEguSOILuJFKJZeduE+hPvBxFt9BagDYMJgPoNGPpTQiSMB6clHG4EsuGNPJOkZV9OSBNvKHSCdVXmgKpRe/5Sh+WhSC1RGrqhTpFjuEmKiK9HNUvB4wrx91NoOOgYEyipiF47EdK0XXcMkBoJ42BJCzBOxWF5Ne45aKQfEbDJgbud0ZK0bsb7UeyUBBSwEhpIiRxSScAnYlcLHDTfjTqTNgPAkKBWw5MyybGpPetoZo+G1Kwtj+0OCMHpEGwddCQu1to5Vc7ULF5UmsZM7Fn3OK7qZE96deKqrMtAnvpTYIpR0yKmar4U64kJUHyxKzknEby4ou4hJRFXHKWSTzVt1RyD/1hRtPbqcsBM0xpywG9ZYZpOKgzJJautrCUaaozpFE7Xb00SAxTMqRxhmlca0hy1p8PK5NkSJl/c6y0kyG10xffiiKNfrWF9NjLrheKiZAYRUbRK/GHysKgvpCiK+QjN7t85duIKV/5NmpqyjyJNrzTDrU9XxUgasoDSWh3mglJPA0gPCryJLitPkBRSKJfKQ4vIGgIJHHoQWFIokxNXlFIJz95ayakCUyKQ2pTU1FI4hBGXjMh0ZFzKjHcTq3iPUk8iU2F5GdQhSH5psKQqBoLqUxP8k3/V5D8nlS0fOs/+/eUguVbenvzQGhi+bbV6tAY3JELQmr7pmLlWxruJwAhU2MgnYKtnWKVSTHYWuzhZEsIir6hJ6M1hhROSxIWf7N7UsyUa8FE7Eg1hsRIcFs8waWQYJhVwFBGiT2JYercpFTyhfmVxzgk9hG+xiH59bNOuroA/4mavt39pNEkw0Szsg9xSD8Aehmmcb5T+Fc/7j4wvvH4NbrD+4e/WaXYj3d/RTc9fGG16+dDrFs/PLDqt98f/o5u+sI0fXtg941zfb1j6mPU8+mB6Ym1nDaMaYq3/HMZ0z3b9JDjh1rP9f0DQwkd4P4Hw/Mp4UCPLNPPpOZ9ZJhiV7C0iYuLi4uLi4vrz8lYlXhbwNOqxA//41WVb0f6V8a28KsdbBT/4XX2cdCiuAmjVXHTZfr1C9cY/nnDh/8vcZ7eP2Wwwmf/Yx+SlOMVIf/8nvYvk4GmTBP+fSj8vgOMNvleRoLP/r3o9SWbPZqD6q6cV83dL2AxW6BnmxyeDxt3C3B8S7FNZxt0sOC4Bc3R8Rq5xHTWBzd7HEiHhePqMFuD5Uh4i/ZTg5r200yT6i7cPYHXFzCdKcyRs8HO69HZsE5s/bZFuyfQZ+ioATkGzS2pKVLpsS1nZR1ce4uMhbOwnl/g7aDiFTIspKb56PfcHT5QSEhdINsybWdr75zMg0nOyj4+w/EVLCQRZFkWhWSvncyXHan+fhHsKCQ01ZFuq+DsaFNZb9FZ7zXJ2Rhoa9LTIs7GPrwwHKnaPc/n7tZCGrzsgCBzgQx4c2B1wH6bNs9pvin93nZvPAeQCNqRYLitUObBJHpmG8eYBZB0NCPBcPN3lSGVXqgpMl8DSBY6TrE/3CQ2JJcOhFcJWfRghNBjzN2yb57aHVXLMtUzSKYPaU4hwevsmBqLA0juOyQdtLUzN2ngZkKyYfULEgF9u3/zIS3YkBa/IC3A2tL+SwM3KQ5pWxoSQVN7YZ1B2hPVXVPqEqbRwE2NdlOHWM4aZkd77ui2jmdveSA5U5uO5d2ztXEkU8O7XR5IdKS8uH4AWOynTxKsZ3khWfTk/OE294cbsdxXhiNdG4RmtkqHynHm9+rFYYZeDLD29JTxIf1WO3Vf0MwA3UErpBOEjqY/BZgzILk7+kV/5yuHaA462P4UgAVpv0OuBeYBrfYLanVVCCCx3v+3fj4ieuvRD8ilgfu9uVfSeYu1jKs1RSX6biSQ5Lspqyh0V8p9J/eH228Hyb4QBTWd/Xse63n690iZ66LNyryVc1bu1j3fnX2QXip+pyIXF1dBRQLibF9NM+otJ1yz2B0rakddpWoGTVMXNhha8FZy/7MPSVerbll99OrOkOo8H3Y22jtHjF/QARmvRzp9ruZNmHUURnP/fWs+ET/NUad08mbSvM0qUw/7n9UcOSvQafYGZD1ztW2QsL0+uy6ff53JXCFbpz1pg1TN0TaOSXvWbvbkZz5c78KzxdwxLLQjNPV/Q5LpvFBOu2fKjMekf4TJfEUz6umcGKuVPbXAXs01mC4Ab7LrqlxcXFxcXFxcXFxcXFxcXFxcXFxcXFy30n8BPEecs4GbF90AAAAASUVORK5CYII=" alt="Stack Data Structure and Implementation in Python, Java and C/C++"></p>
<h2 id="basic-OP-code"><a href="#basic-OP-code" class="headerlink" title="basic OP code"></a>basic OP code</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* &#x521D;&#x59CB;&#x5316;&#x6808; */</span></span><br><span class="line">stack&lt;<span class="type">int</span>&gt; stack;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* &#x5143;&#x7D20;&#x5165;&#x6808; */</span></span><br><span class="line">stack.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#x8BBF;&#x95EE;&#x6808;&#x9876;&#x5143;&#x7D20; */</span></span><br><span class="line">    <span class="type">int</span> top = stack.<span class="built_in">top</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#x5143;&#x7D20;&#x51FA;&#x6808; */</span></span><br><span class="line">    stack.<span class="built_in">pop</span>(); <span class="comment">// &#x65E0;&#x8FD4;&#x56DE;&#x503C;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#x83B7;&#x53D6;&#x6808;&#x7684;&#x957F;&#x5EA6; */</span></span><br><span class="line">    <span class="type">int</span> size = stack.<span class="built_in">size</span>();</span><br><span class="line"><span class="comment">/* &#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x7A7A; */</span></span><br><span class="line">    <span class="type">bool</span> empty = stack.<span class="built_in">empty</span>();</span><br></pre></td></tr></table></figure>

<h2 id="Stack-Realization-Based-on-LinkList"><a href="#Stack-Realization-Based-on-LinkList" class="headerlink" title="Stack Realization Based on LinkList"></a>Stack Realization Based on LinkList</h2><h3 id="stack-structure"><a href="#stack-structure" class="headerlink" title="stack structure"></a>stack structure</h3><p>every element in this stack is a <strong>listNode</strong> which has this structure</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">listNode</span>{</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">MyStack</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    listNode* next;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">listNode</span>();</span><br><span class="line">    <span class="built_in">listNode</span>(<span class="type">int</span> nodeData, listNode* succ = <span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>The indispensable compositions of a stack are</p>
<ol>
<li>a top-pointer for keeping track of the <strong>most recently added item</strong>, the stack&#x2019;s top pointer allows you to quickly access and manipulate the top element.</li>
<li>stackSize</li>
</ol>
<p>So we have</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    listNode* topNode;</span><br><span class="line">    <span class="type">int</span> stackSize;</span><br></pre></td></tr></table></figure>

<h1 id="Some-real-shit"><a href="#Some-real-shit" class="headerlink" title="Some real shit"></a>Some real shit</h1><p>&#x6D17;&#x5E72;&#x51C0;&#x7684;&#x76D8;&#x5B50;&#x603B;&#x662F;&#x9010;&#x4E2A;&#x5F80;&#x4E0A;&#x53E0;&#x653E;&#x5728;&#x5DF2;&#x7ECF;&#x6D17;&#x597D;&#x7684;&#x76D8;&#x5B50;&#x4E0A;&#x9762;&#xFF0C;&#x800C;&#x7528;&#x65F6;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#x9010;&#x4E2A;&#x53D6;&#x7528; &#x3002;</p>
<p>So In programming, if you need to use data <strong>in the reverse order</strong> of how it was saved, you can use a stack to do it.</p>
<h2 id="&#x62EC;&#x53F7;&#x5339;&#x914D;&#x7684;&#x68C0;&#x9A8C;"><a href="#&#x62EC;&#x53F7;&#x5339;&#x914D;&#x7684;&#x68C0;&#x9A8C;" class="headerlink" title="&#x62EC;&#x53F7;&#x5339;&#x914D;&#x7684;&#x68C0;&#x9A8C;"></a>&#x62EC;&#x53F7;&#x5339;&#x914D;&#x7684;&#x68C0;&#x9A8C;</h2><p>&#x5047;&#x8BBE;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x5141;&#x8BB8;&#x5305;&#x542B;&#x4E24;&#x79CD;&#x62EC;&#x53F7;&#xFF1A;&#x5706;&#x62EC;&#x53F7;&#x548C;&#x65B9;&#x62EC;&#x53F7;&#xFF0C;&#x5176;&#x5D4C;&#x5957;&#x7684;&#x987A;&#x5E8F;&#x968F;&#x610F;&#xFF0C;&#x5373;([ ] (&#xFF09;)&#x6216;[ ([ ] [ &#xFF3D;&#xFF09;&#xFF3D;&#x7B49;&#x4E3A;&#x6B63;&#x786E;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#xFF3B;&#xFF08;&#xFF3D;&#x6216;&#xFF08;&#xFF3B;&#xFF08;&#xFF09;&#xFF09;&#x6216;&#xFF08;&#xFF08;&#xFF09;&#xFF3D;&#xFF09;&#x5747;&#x4E3A;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x683C;&#x5F0F;&#x3002;&#x68C0;&#x9A8C;&#x62EC;&#x53F7;&#x662F;&#x5426;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x7528;&#x201D;<strong>&#x671F;&#x5F85;&#x7684;&#x6025;&#x8FEB;&#x7A0B;&#x5EA6;</strong>&#x201D;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x6765;&#x63CF;&#x8FF0; &#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x8003;&#x8651;&#x4E0B;&#x5217;&#x62EC;&#x53F7;&#x5E8F;&#x5217;&#xFF1A;<br>[ ([ ] [ ]) ] &#x6309;&#x4ECE; 1-8 &#x7F16;&#x53F7;</p>
<p>&#x5F53;&#x8BA1;&#x7B97;&#x673A;&#x63A5;&#x53D7;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;&#x540E;,&#x5B83;&#x671F;&#x5F85;&#x7740;&#x4E0E;&#x5176;&#x5339;&#x914D;&#x7684;&#x7B2C;&#x516B;&#x4E2A;&#x62EC;&#x53F7;&#x7684;&#x51FA;&#x73B0;,&#x7136;&#x800C;&#x7B49;&#x6765;&#x7684;&#x5374;&#x662F;<br>&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;,&#x663E;&#x7136;&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;&#x7684;&#x671F;&#x5F85;&#x6025;&#x8FEB;&#x6027;&#x9AD8;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;,&#x6B64;&#x65F6;&#x7B2C;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;&#x201C;[&#x201D;&#x53EA;&#x80FD;&#x6682;&#x65F6;&#x9760;<br>&#x8FB9;,&#x800C;&#x8FEB;&#x5207;&#x7B49;&#x5F85;&#x4E0E;&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;&#x76F8;&#x5339;&#x914D;&#x7684;&#x3001;&#x7B2C;&#x4E03;&#x4E2A;&#x62EC;&#x53F7;&#x201C;)&#x201D;&#x7684;&#x51FA;&#x73B0;&#x3002;&#x7C7B;&#x4F3C;&#x5730;,&#x56E0;&#x7B49;&#x6765;&#x7684;&#x662F;&#x7B2C;&#x4E09;&#x4E2A;<br>&#x62EC;&#x53F7;&#x201C;[&#x201D;,&#x5176;&#x671F;&#x5F85;&#x5339;&#x914D;&#x7684;&#x7A0B;&#x5EA6;&#x8F83;&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;&#x66F4;&#x6025;&#x8FEB;,&#x5219;&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;&#x4E5F;&#x53EA;&#x80FD;&#x9760;&#x8FB9;,&#x8BA9;&#x4F4D;&#x4E8E;&#x7B2C;&#x4E09;&#x4E2A;<br>&#x62EC;&#x53F7;&#x3002;&#x5728;&#x63A5;&#x53D7;&#x4E86;&#x7B2C;&#x56DB;&#x4E2A;&#x62EC;&#x53F7;&#x4E4B;&#x540E;,&#x7B2C;&#x4E09;&#x4E2A;&#x62EC;&#x53F7;&#x7684;<strong>&#x671F;&#x5F85;&#x5F97;&#x5230;&#x6EE1;&#x8DB3;</strong>,<strong>&#x6D88;&#x89E3;&#x4E4B;&#x540E;</strong>,&#x7B2C;&#x4E8C;&#x4E2A;&#x62EC;&#x53F7;&#x7684;&#x671F;&#x5F85;<br>&#x5339;&#x914D;&#x5C31;&#x6210;&#x4E3A;&#x5F53;&#x524D;&#x6700;&#x6025;&#x8FEB;&#x7684;&#x4EFB;&#x52A1;&#x4E86;, &#x2026;&#x2026; ,&#x4F9D;&#x6B21;&#x7C7B;&#x63A8;&#x3002;&#x53EF;&#x89C1;,&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x6070;&#x4E0E;&#x6808;&#x7684;&#x7279;&#x70B9;&#x76F8;&#x543B;&#x5408;&#x3002;<br>&#x6BCF;&#x8BFB;&#x5165;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;,&#x82E5;&#x662F;&#x53F3;&#x62EC;&#x53F7;,&#x5219;&#x6216;&#x8005;&#x4F7F;&#x7F6E;&#x4E8E;&#x6808;&#x9876;&#x7684;&#x6700;&#x6025;&#x8FEB;&#x7684;&#x671F;&#x5F85;&#x5F97;&#x4EE5;&#x6D88;&#x89E3;,&#x6216;&#x8005;&#x662F;&#x4E0D;&#x5408;&#x6CD5;&#x7684;<br>&#x60C5;&#x51B5;;&#x82E5;&#x662F;&#x5DE6;&#x62EC;&#x53F7;,&#x5219;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x66F4;&#x6025;&#x8FEB;&#x7684;&#x671F;&#x5F85;&#x538B;&#x5165;&#x6808;&#x4E2D;,&#x81EA;&#x7136;&#x4F7F;&#x539F;&#x6709;&#x7684;&#x5728;&#x6808;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x672A;&#x6D88;<br>&#x89E3;&#x7684;&#x671F;&#x5F85;&#x7684;&#x6025;&#x8FEB;&#x6027;&#x90FD;&#x964D;&#x4E86;&#x4E00;&#x7EA7;&#x3002;</p>
<h2 id="Some-data-structures-are-Originally-recursive"><a href="#Some-data-structures-are-Originally-recursive" class="headerlink" title="Some data structures are Originally recursive"></a>Some data structures are <strong>Originally</strong> recursive</h2><p>For example ,linklist,</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class listNode</span><br><span class="line">{</span><br><span class="line">    friend class linkList;</span><br><span class="line">    friend void merge(linkList &amp;, linkList &amp;);</span><br><span class="line">    float data;</span><br><span class="line">    listNode *next;}</span><br></pre></td></tr></table></figure>

<p>It uses itself inside its definition,</p>
<h1 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h1><p>what is Queue?<br>A queue is a data structure that follows the First-In-First-Out (FIFO) principle. This means that the first element added to the queue will be the first one to be removed. Queues are commonly used in scenarios where order needs to be <strong>preserved</strong>.</p>
<p>In a queue, you add items at the rear and remove them from the front. This creates a first-in, first-out (FIFO) structure, meaning the first item added is the first one to be removed.</p>
<h2 id="basic-op"><a href="#basic-op" class="headerlink" title="basic op"></a>basic op</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/_ Initialize the queue _/</span><br><span class="line">queue&lt;int&gt; queue;</span><br><span class="line"></span><br><span class="line">/_ Add elements to the queue _/</span><br><span class="line">queue.push(1);</span><br><span class="line"></span><br><span class="line">/_ Access the front element of the queue _/</span><br><span class="line">int front = queue.front();</span><br><span class="line"></span><br><span class="line">/_ Remove the front element from the queue _/</span><br><span class="line">queue.pop(); // No return value</span><br><span class="line"></span><br><span class="line">/_ Get the size of the queue _/</span><br><span class="line">int size = queue.size();</span><br><span class="line"></span><br><span class="line">/_ Check if the queue is empty _/</span><br><span class="line">bool empty = queue.empty();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="senario"><a href="#senario" class="headerlink" title="senario"></a>senario</h2><p>In server environments, queues help manage incoming requests, processing them in the order they arrive to maintain fairness. Why fairness? Because the first request that arrives should be the first one to be processed.<br>I can articulate this by using server-side-code</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processRequest</span><span class="params">(std::queue&lt;Request&gt;&amp; requests)</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (!requests.<span class="built_in">empty</span>()) {</span><br><span class="line">        Request request = requests.<span class="built_in">front</span>();</span><br><span class="line">        requests.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">process</span>(request);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="implementation"><a href="#implementation" class="headerlink" title="implementation"></a>implementation</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> {</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* queue;       <span class="comment">// Array to hold the queue elements</span></span><br><span class="line">    <span class="type">int</span> capacity;     <span class="comment">// Maximum number of elements the queue can hold</span></span><br><span class="line">    <span class="type">int</span> front;        <span class="comment">// Index of the front element</span></span><br><span class="line">    <span class="type">int</span> rear;         <span class="comment">// Index of the rear element</span></span><br><span class="line">    <span class="type">int</span> count;        <span class="comment">// Current size of the queue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Constructor to initialize the queue</span></span><br><span class="line">    <span class="built_in">MyQueue</span>(<span class="type">const</span> <span class="type">int</span>&amp; capacity) : <span class="built_in">capacity</span>(capacity), <span class="built_in">front</span>(<span class="number">0</span>), <span class="built_in">rear</span>(<span class="number">-1</span>), <span class="built_in">count</span>(<span class="number">0</span>) {</span><br><span class="line">        queue = <span class="keyword">new</span> <span class="type">int</span>[capacity]; <span class="comment">// Allocate memory for the queue</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Destructor to free memory</span></span><br><span class="line">    ~<span class="built_in">MyQueue</span>() {</span><br><span class="line">        <span class="keyword">delete</span>[] queue; <span class="comment">// Deallocate the queue array</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Additional methods like enqueue, dequeue, etc., can be added here</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x961F;&#x5217;&#x7684;rear&#x662F;&#x6307;&#x53EF;&#x4EE5;&#x52A0;&#x5165;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x5417;&#xFF0C;&#x8FD8;&#x662F;&#x76EE;&#x524D;&#x961F;&#x5217;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15; front&#x5462;</p>
<ol>
<li><p>**<code>front</code>**&#xFF1A;&#x6307;&#x5411;&#x961F;&#x5217;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x3002; &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8FD9;&#x662F;&#x5373;&#x5C06;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x3002; </p>
</li>
<li><p><strong><code>rear</code><strong>&#xFF1A;</strong>&#x6307;&#x5411;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x5143;&#x7D20;&#x7684;&#x4F4D;&#x7F6E;</strong>&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code>rear</code> &#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x8981;&#x63D2;&#x5165;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x800C;&#x4E0D;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x3002;</p>
</li>
<li><h3 id="&#x961F;&#x5217;&#x7684;&#x72B6;&#x6001;"><a href="#&#x961F;&#x5217;&#x7684;&#x72B6;&#x6001;" class="headerlink" title="&#x961F;&#x5217;&#x7684;&#x72B6;&#x6001;"></a>&#x961F;&#x5217;&#x7684;&#x72B6;&#x6001;</h3><ul>
<li><strong>&#x7A7A;&#x961F;&#x5217;</strong>&#xFF1A;<code>front</code> &#x548C; <code>rear</code> &#x90FD;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E14;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x3002;</li>
<li><strong>&#x6EE1;&#x961F;&#x5217;</strong>&#xFF1A;<code>rear</code> &#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x662F; <code>front</code>&#xFF0C;&#x5373; <code>(rear + 1) % capacity == front</code> &#x5FAA;&#x73AF;&#x8FC7;&#x6765;&#x7684;</li>
</ul>
</li>
</ol>
<h2 id="&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x7684;"><a href="#&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x7684;" class="headerlink" title="&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x7684;"></a>&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x7684;</h2><h3 id="&#x961F;&#x5217;&#x521D;&#x59CB;&#x5316;"><a href="#&#x961F;&#x5217;&#x521D;&#x59CB;&#x5316;" class="headerlink" title="&#x961F;&#x5217;&#x521D;&#x59CB;&#x5316;"></a>&#x961F;&#x5217;&#x521D;&#x59CB;&#x5316;</h3><p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5BB9;&#x91CF;&#x4E3A; 5 &#x7684;&#x961F;&#x5217;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">capacity = 5</span><br><span class="line">queue = [_, _, _, _, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 0</span><br><span class="line">count = 0</span><br></pre></td></tr></table></figure>

<h3 id="&#x7A7A;&#x961F;&#x5217;&#x72B6;&#x6001;"><a href="#&#x7A7A;&#x961F;&#x5217;&#x72B6;&#x6001;" class="headerlink" title="&#x7A7A;&#x961F;&#x5217;&#x72B6;&#x6001;"></a>&#x7A7A;&#x961F;&#x5217;&#x72B6;&#x6001;</h3><p>&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#xFF0C;<code>front</code> &#x548C; <code>rear</code> &#x90FD;&#x6307;&#x5411;&#x4F4D;&#x7F6E; 0&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [_, _, _, _, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 0</span><br><span class="line">count = 0</span><br></pre></td></tr></table></figure>

<h3 id="&#x63D2;&#x5165;&#x5143;&#x7D20;"><a href="#&#x63D2;&#x5165;&#x5143;&#x7D20;" class="headerlink" title="&#x63D2;&#x5165;&#x5143;&#x7D20;"></a>&#x63D2;&#x5165;&#x5143;&#x7D20;</h3><p>&#x6211;&#x4EEC;&#x4F9D;&#x6B21;&#x63D2;&#x5165; 4 &#x4E2A;&#x5143;&#x7D20;&#xFF08;10, 20, 30, 40&#xFF09;&#xFF1A;</p>
<ol>
<li><p>&#x63D2;&#x5165; 10&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [10, _, _, _, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 1</span><br><span class="line">count = 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x63D2;&#x5165;20</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [10, 20, _, _, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 2</span><br><span class="line">count = 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x63D2;&#x5165;30</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [10, 20, 30, _, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 3</span><br><span class="line">count = 3</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x63D2;&#x5165;40</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [10, 20, 30, 40, _]</span><br><span class="line">front = 0</span><br><span class="line">rear = 4</span><br><span class="line">count = 4</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="&#x6EE1;&#x961F;&#x5217;&#x72B6;&#x6001;"><a href="#&#x6EE1;&#x961F;&#x5217;&#x72B6;&#x6001;" class="headerlink" title="&#x6EE1;&#x961F;&#x5217;&#x72B6;&#x6001;"></a>&#x6EE1;&#x961F;&#x5217;&#x72B6;&#x6001;</h3><p>&#x518D;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF08;50&#xFF09;&#xFF0C;&#x961F;&#x5217;&#x5C06;&#x6EE1;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">queue = [10, 20, 30, 40, 50]</span><br><span class="line">front = 0</span><br><span class="line">rear = 0  // rear &#x56DE;&#x5230;&#x8D77;&#x70B9;</span><br><span class="line">count = 5</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h3><ol>
<li><p>&#x6BCF;&#x6B21;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x540E; <code>rear</code> &#x90FD;&#x4F1A;&#x66F4;&#x65B0;&#x4E3A; <code>(rear + 1) % capacity</code>&#x3002;</p>
</li>
<li><p>rear&#x6C38;&#x8FDC;&#x4E0D;&#x5E94;&#x8BE5;&#x7B49;&#x4E8E;=capacity &#x6700;&#x5927;&#x503C;&#x662F;capacity-1 &#x5E94;&#x4E3A;&#x5F53;rear&#x4E3A;capacity-1 &#x7684;&#x65F6;&#x5019;&#x5C31;&#x610F;&#x5473;&#x7740;&#x4E0B;&#x4E00;&#x4E2A;&#x8981;&#x63D2;&#x5165;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<strong>&#x4E0B;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684;&#x4F4D;&#x7F6E;&#x662F;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x7A7A;&#x4F4D;&#x4E86;</strong></p>
</li>
<li><p><strong>&#x66F4;&#x65B0; <code>front</code> &#x7684;&#x4F4D;&#x7F6E;</strong>&#xFF1A;&#x5728;&#x5FAA;&#x73AF;&#x4E2D;&#x9700;&#x8981;&#x79FB;&#x52A8;&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x9700;&#x8981;&#x6574;&#x4E2A;&#x6570;&#x7EC4;&#x79FB;&#x52A8;&#x3002;&#x4F60;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x66F4;&#x65B0; <code>front</code> &#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">item = queue[front]; // &#x83B7;&#x53D6; front &#x6307;&#x5411;&#x7684;&#x5143;&#x7D20;</span><br><span class="line">    front = (front + 1) % capacity; // &#x66F4;&#x65B0; front &#x7684;&#x4F4D;&#x7F6E;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>Stack</tag>
        <tag>Data structure</tag>
      </tags>
  </entry>
  <entry>
    <title>Virtual Memory</title>
    <url>/2024/10/20/Virtual%20Memory/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>You open a web browser, a text editor, and a game concurrently. Together, these applications consume <strong>10 GB of RAM</strong>.</p>
<span id="more"></span>

<p>Since you only have 8 GB of physical RAM, the system cannot keep all the data in RAM <strong>at once</strong>.<br>So OS uses a technique to do that:<br>Use the disk to temporarily store <strong>less-used</strong> data and free up RAM for <strong>more important</strong> data. Like 2GB of data is stored in the disk and 8GB of data is stored in the RAM.<br>When an application needs more RAM to process or generate more data, add new features, or respond to user actions, it can request additional RAM from the operating system. If the physical RAM is insufficient, the OS manages memory by swapping less-used data to disk to free up RAM for the application.</p>
<h1 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h1><p><strong>Virtual memory</strong> is a memory management <strong>technique</strong> that allows an application to use <strong>more</strong> memory than what is physically available on the system. It does this by using disk space as an <strong>extension</strong> of RAM.</p>
<p>What to do when the CPU needs to access the <strong>less-used</strong> data that is not in the memory since you have removed it?<br>The OS load the corresponding data from disk to the memory<br><img src="https://imgur.com/7Uu9Dge.png"></p>
<h1 id="Why-this-called-Virtual-Memory"><a href="#Why-this-called-Virtual-Memory" class="headerlink" title="Why this called Virtual Memory?"></a>Why this called Virtual Memory?</h1><p>Virtual Memory is for the Program to say.<br>The memory space is numbered, that is, each small block of memory has its own address.<br>There are two types of addresses:Virtual Address and Physical Address<br>From this 10GB Program&#x2019;s perspective,it sees a table of numbers that is 10GB in size., And When it needs to access data, it uses virtual addresses within that 10GB space.</p>
<h1 id="Senario"><a href="#Senario" class="headerlink" title="Senario"></a>Senario</h1><p>So, when an instruction in your game says to go to address 1000 to get the health-value data of this user, will the CPU go to address 1000 to get it?What if it does go to address 1000,what will it get? No,it will not get the health-value data of this user, So, how does the CPU know where is the right place to get the data? This is where the MMU comes in.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MOV REG,1000  this instruction loads a value from the virtual address 1000 into a register</span><br></pre></td></tr></table></figure>

<p>this 1000 is virtual-address.The cpu will parse this instruction<br>After that the parsing-result will be sent to MMU</p>
<h2 id="MMU"><a href="#MMU" class="headerlink" title="MMU"></a>MMU</h2><p>MMU is an address translator<br>It converts virtual addresses into physical addresses</p>
<p>So after the MMU conversion, the CPU uses this physical address to go to the right place to access the memory (read memory&#x2018;s data or write data to the memory).</p>
<pre><code>      +---------------------+
      |         CPU         |
      |                     |
      |   MOV REG, 1000    |
      +----------+----------+
                 |
                 | (&#x865A;&#x62DF;&#x5730;&#x5740;: 1000)
                 v
      +---------------------+
      |         MMU         |
      |  (&#x5730;&#x5740;&#x8F6C;&#x6362;&#x5668;)       |
      +----------+----------+
                 |
                 | (&#x7269;&#x7406;&#x5730;&#x5740;&#x8F6C;&#x6362;)
                 v
      +---------------------+
      |     &#x7269;&#x7406;&#x5730;&#x5740;        |
      |                     |
      |   (&#x8BFB;/&#x5199;&#x6570;&#x636E;)      |
      +----------+----------+
</code></pre>
<h1 id="How-MMU-works"><a href="#How-MMU-works" class="headerlink" title="How MMU works"></a>How MMU works</h1><ol>
<li><p>The CPU sends the virtual address to the <strong>MMU</strong> for translation. &#x201C;hey give me the actual address of this virtual address&#x201D;</p>
<p>The virtual address is divided into <strong>page number</strong> and <strong>offset</strong>.</p>
</li>
<li><p>The MMU checks the <strong>page table</strong> to find the corresponding <strong>physical address</strong>. How? It looks up the page table to see if the virtual address is mapped to a physical address.</p>
<p>If the entry exists, the physical address is retrieved.</p>
</li>
<li><p>The MMU sends the physical address to the memory controller.The controller is a part of the CPU that manages memory access.</p>
<p>The controller accesses the <strong>physical memory (RAM)</strong> to read or write data.</p>
</li>
<li><p>Page Fault Handling (if needed)</p>
</li>
</ol>
<p>If the virtual address isn&#x2019;t mapped which means a page fault occurs, the OS handles it by performing the following steps:</p>
<ul>
<li>Check if there are any free frames in memory.</li>
<li>If there are free frames, allocate one for the page.</li>
<li>If there are no free frames, select a victim page to evict from memory.</li>
<li>The OS retrieves the required data from <strong>disk storage</strong>. Load the required page from disk into the selected frame.</li>
<li>Update the page table with the new mapping.</li>
<li>Resume the interrupted instruction that caused the page fault.Which is Returns to step 3 to complete the address translation.</li>
</ul>
<p><img src="https://imgur.com/zjbcuyG.png"></p>
<h1 id="page-table"><a href="#page-table" class="headerlink" title="page-table"></a>page-table</h1><p>A <strong>page table</strong> is a <strong>data structure</strong> used by the MMU to translate virtual addresses to physical addresses.</p>
<p>It contains a list of <strong>page table entries (PTEs)</strong> that map virtual pages to physical frames. Each PTE includes:</p>
<ul>
<li>&#x6709;&#x6548;/&#x65E0;&#x6548;&#x4F4D;&#xFF1A;whether the page is currently loaded in memory</li>
<li>&#x7269;&#x7406;&#x5730;&#x5740;&#xFF1A;&#x6307;&#x5411;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x7269;&#x7406;&#x9875;&#x6846;</li>
<li>&#x5176;&#x4ED6;&#x63A7;&#x5236;&#x4F4D;&#xFF1A;&#x4F8B;&#x5982;&#x8BFB;/&#x5199;&#x6743;&#x9650;&#x3001;&#x7528;&#x6237;/&#x5185;&#x6838;&#x6743;&#x9650;&#x7B49;<br>so on</li>
</ul>
<p><img src="https://imgur.com/wHlFmqj.png"></p>
]]></content>
      <tags>
        <tag>计算机组成原理</tag>
        <tag>cs app</tag>
      </tags>
  </entry>
  <entry>
    <title>How to use axios and cheerio to grab bullshit</title>
    <url>/2024/10/18/axiosAndcheerio/</url>
    <content><![CDATA[<p>Basically, to delivery this toy is to use axios to accomplish <strong>http-request</strong> and to use cheerio to <strong>parse and extract</strong> the info you need.</p>
<h2 id="What-is-axios"><a href="#What-is-axios" class="headerlink" title="What is axios"></a>What is axios</h2><p>axios is an <strong>library</strong> based on <strong>Promise</strong> providing you a capability to realize a http request.</p>
<p>Why choose it? It simplifies the process for sending an Internet request.</p>
<h2 id="What-is-cheerio"><a href="#What-is-cheerio" class="headerlink" title="What is cheerio"></a>What is cheerio</h2><p>Cheerio is a fast and lightweight <strong>library</strong> for manipulation of <strong>HTML and XML documents.</strong></p>
<p>It&#x2019;s designed for use in Node.js environments, allowing you to easily parse, traverse, and manipulate the structure of web pages.</p>
<p>With Cheerio, you can load HTML content, select elements using familiar jQuery selectors, and extract or modify data.</p>
<h2 id="write-js-code"><a href="#write-js-code" class="headerlink" title="write js code"></a>write js code</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&quot;cheerio&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Using these to introduce them.</p>
<p>design a <strong>async</strong>-function to wrap it.Why async? The function makes an HTTP request, which can take time (like waiting for a server response). Using <code>async</code> allows the function to pause execution until the request is completed <strong>without blocking other operations.</strong></p>
<p>You can add a console.log(&#x201C;waiting&#x201D;); after you call the function.It will be printed first.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">await axios.get(url);</span><br></pre></td></tr></table></figure>

<p>this <strong>await</strong> shall pause the function-exection and <strong>axios.get</strong> shall get the info.</p>
<h3 id="what-does-axios-get-return"><a href="#what-does-axios-get-return" class="headerlink" title="what does axios.get return"></a>what does axios.get return</h3><p>It returns a <strong>Promise</strong> and the Promise will <strong>resolve to an object</strong> wrapping the HTTP response.<br>this object has lots of properties to show information about this Internet request.</p>
<p>like status:200 statusText:ok response-headers</p>
<p>And the data: The body of the response returned by the server, usually data in HTML, JSON</p>
<p>That&#x2019;s what we need.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> { data } = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(data);</span><br><span class="line">$(<span class="string">&quot;h1&quot;</span>).<span class="title function_">each</span>(<span class="function">(<span class="params">i, element</span>) =&gt;</span> {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>($(element).<span class="title function_">text</span>());</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x5C06; HTML &#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230; Cheerio &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; jQuery &#x98CE;&#x683C;&#x7684;&#x9009;&#x62E9;&#x5668;&#x6765;&#x64CD;&#x4F5C;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x3002;</p>
<p><strong><code>$(&quot;h1&quot;).each((i, element) =&gt; {...});</code></strong>: &#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x9009;&#x62E9;&#x6240;&#x6709;&#x7684; <code>&lt;h1&gt;</code> &#x6807;&#x7B7E;&#xFF0C;&#x5E76;&#x5BF9;&#x6BCF;&#x4E2A;&#x627E;&#x5230;&#x7684;&#x5143;&#x7D20;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<p><strong><code>console.log($(element).text());</code></strong>: &#x5728;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;<code>$(element).text()</code> &#x83B7;&#x53D6;&#x5F53;&#x524D; <code>&lt;h1&gt;</code> &#x5143;&#x7D20;&#x7684;&#x6587;&#x672C;&#x5185;&#x5BB9;</p>
]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>axios</tag>
        <tag>cheerio</tag>
      </tags>
  </entry>
  <entry>
    <title>Process &amp; Thread</title>
    <url>/2024/10/17/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<p><img src="https://www.ruanyifeng.com/blogimg/asset/201304/bg2013042411.png" alt="img"></p>
<p>&#x7A0B;&#x5E8F;&#x5458;&#x5199;&#x5B8C;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x4EE5;&#x540E;&#xFF0C;&#x7A0B;&#x5E8F;&#x53BB;&#x54EA;&#x91CC;&#x4E86;&#xFF1F;</p>
<span id="more"></span>

<h1 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h1><p>After a programmer finishes writing a program, it is saved permanently on the hard drive. Just as a chef needs a cutting board and a countertop to prepare food, the CPU needs to load the program from the hard drive to execute it.</p>
<p>What&#x2019;s loaded into memory is a process, which is an <strong>executable instance</strong> of the program.<br>A single program can be loaded into memory <strong>multiple times</strong>, or <strong>multiple programs</strong> can be loaded into memory.Which means there will be existing <strong>multiple process</strong> in memory.</p>
<p>Every physical memory spot in memory has been labeled with <strong>physical address</strong><br>Looking into memory,there lies processes.<br>Each process has its own <strong>virtual address space</strong>, These virtual address space can be converted to **physical address.**to access the corresponding <strong>memory spot.</strong></p>
<h2 id="feature-of-Process"><a href="#feature-of-Process" class="headerlink" title="feature of Process"></a>feature of Process</h2><p>Each process thinks it has the <strong>entire memory</strong> and doesn&#x2019;t need to care about other processes</p>
<p>In this way, processes are separated</p>
<h1 id="What&#x2019;s-in-each-process-&#xFF1A;Thread"><a href="#What&#x2019;s-in-each-process-&#xFF1A;Thread" class="headerlink" title="What&#x2019;s in each process &#xFF1A;Thread"></a>What&#x2019;s in each process &#xFF1A;Thread</h1><p>&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;<br>It&#x2019;s going to compute based on the program-flow<br>one of the program-flow or <strong>execution streams</strong> here is one thread<br>if there are multiple threads<br>You need multiple <strong>program counters</strong></p>
<h1 id="So-why-do-we-need-a-design-thread"><a href="#So-why-do-we-need-a-design-thread" class="headerlink" title="So why do we need a design thread"></a>So why do we need a design thread</h1><p>we look at it through <strong>a document editor</strong> Like a notepad</p>
<p>This notepad holds some text-data and some document which makes it a process</p>
<p>Now the user uses the keyboard to type a return at the end of the second line</p>
<p>There needs to be <strong>an interactive program</strong> that knows about keyboard <strong>press events</strong> and then the process that manages the layout recalculates the text and renders it</p>
<p>and every once in a while the writing-program needs to save the document to the hard disk</p>
<p><strong>Three programs</strong> need to execute <strong>concurrently</strong>, but they must access and modify the same document. Since processes have their own <strong>independent memory spaces</strong>, they must operate within the same process to access shared resources. Therefore, three lighter-weight constructs&#x2014;threads&#x2014;are necessary for this scenario.</p>
<p>Threads allow these programs to run in parallel while sharing the same memory space for document access and modification.</p>
<pre><code>    +-----------------+
     |    Notepad      |
     | (Document Data) |
     +-----------------+
            &#x2191;
            |
            | (User Input)
            |
     +-----------------+
     | Interactive Prog |
     +-----------------+
            |
            v
     +-----------------+
     |   Layout Manager |
     +-----------------+
            |
            | (Save to Disk)
            v
         +-------+
         |  Disk |
         +-------+
</code></pre>
<hr>

<p>Threads are the smallest unit of <strong>parallel execution</strong>.</p>
<p>However, if there is only a single-core CPU, it can execute only one thread at a time. In this case, threads must take turns to run, effectively sharing the CPU. This sharing is managed through <strong>time slicing</strong>, where each thread is allocated a specific time slice to execute.</p>
<p>This mechanism allows multiple threads to make progress by switching between them rapidly, <strong>creating the illusion of concurrent execution even on a single-core system.</strong></p>
]]></content>
      <tags>
        <tag>计算机组成原理</tag>
        <tag>cs app</tag>
        <tag>Process</tag>
      </tags>
  </entry>
</search>
